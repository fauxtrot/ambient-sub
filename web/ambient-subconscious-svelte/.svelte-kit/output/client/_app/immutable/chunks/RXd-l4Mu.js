var qa=Object.defineProperty;var Tn=e=>{throw TypeError(e)};var Da=(e,t,r)=>t in e?qa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var v=(e,t,r)=>Da(e,typeof t!="symbol"?t+"":t,r),Wr=(e,t,r)=>t.has(e)||Tn("Cannot "+r);var o=(e,t,r)=>(Wr(e,t,"read from private field"),r?r.call(e):t.get(e)),A=(e,t,r)=>t.has(e)?Tn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),I=(e,t,r,n)=>(Wr(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),T=(e,t,r)=>(Wr(e,t,"access private method"),r);var Mn=(e,t,r,n)=>({set _(a){I(e,t,a,r)},get _(){return o(e,t,n)}});import{z as $r,F as Fa,B as oe,L as Qr,ax as Pa,G as Va,g as An,I as Na,J as Oa,K as Cn,M as Gr,C as Ir,ae as Ka,aL as za,aq as En,v as he,aO as ye,A as tn,E as La,a4 as ja,aP as mi,aJ as _n,aQ as Ha,aR as Wa,O as $a,ac as kn,aS as Qa,w as hi,y as fi,aT as Jr,aI as Ga,x as Ja,aF as Za,aU as yi,q as In,aV as Xa,_ as Ya,H as es,aW as ts,aB as rs,e as gi,u as bi,aX as ns,aw as vi,aY as is,N as Ft,aZ as wi,a_ as _i,a$ as as,b0 as ss,R as us,b1 as os,b2 as cs,b3 as ls,b4 as ds,b5 as ps,a7 as ms,r as hs,b6 as re,b7 as Qe,Q as fs,t as ys,n as gs,o as bs,aa as ie,k as G}from"./ocTC9fog.js";import{b as vs,a as E,g as $,c as J}from"./Dcw-4Js5.js";import{i as Q,p as ws}from"./CeYpcBse.js";function Oc(e,t){return t}function _s(e,t,r){for(var n=[],a=t.length,s,c=t.length,l=0;l<a;l++){let U=t[l];fi(U,()=>{if(s){if(s.pending.delete(U),s.done.add(U),s.pending.size===0){var _=e.outrogroups;rn(_n(s.done)),_.delete(s),_.size===0&&(e.outrogroups=null)}}else c-=1},!1)}if(c===0){var p=n.length===0&&r!==null;if(p){var f=r,h=f.parentNode;Ga(h),h.append(f),e.items.clear()}rn(t,!p)}else s={pending:new Set(t),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(s)}function rn(e,t=!0){for(var r=0;r<e.length;r++)Ja(e[r],t)}var Rn;function Kc(e,t,r,n,a,s=null){var c=e,l=new Map,p=(t&yi)!==0;if(p){var f=e;c=oe?Qr(Pa(f)):f.appendChild($r())}oe&&Va();var h=null,U=ja(()=>{var g=r();return mi(g)?g:g==null?[]:_n(g)}),_,y=!0;function b(){m.fallback=h,Is(m,_,c,t,n),h!==null&&(_.length===0?(h.f&ye)===0?hi(h):(h.f^=ye,zt(h,null,c)):fi(h,()=>{h=null}))}var w=Fa(()=>{_=An(U);var g=_.length;let S=!1;if(oe){var D=Na(c)===Oa;D!==(g===0)&&(c=Cn(),Qr(c),Gr(!1),S=!0)}for(var N=new Set,P=he,O=La(),K=0;K<g;K+=1){oe&&Ir.nodeType===Ka&&Ir.data===za&&(c=Ir,S=!0,Gr(!1));var ne=_[K],Y=n(ne,K),Z=y?null:l.get(Y);Z?(Z.v&&En(Z.v,ne),Z.i&&En(Z.i,K),O&&P.skipped_effects.delete(Z.e)):(Z=xs(l,y?c:Rn??(Rn=$r()),ne,Y,K,a,t,r),y||(Z.e.f|=ye),l.set(Y,Z)),N.add(Y)}if(g===0&&s&&!h&&(y?h=tn(()=>s(c)):(h=tn(()=>s(Rn??(Rn=$r()))),h.f|=ye)),oe&&g>0&&Qr(Cn()),!y)if(O){for(const[se,pe]of l)N.has(se)||P.skipped_effects.add(pe.e);P.oncommit(b),P.ondiscard(()=>{})}else b();S&&Gr(!0),An(U)}),m={effect:w,items:l,outrogroups:null,fallback:h};y=!1,oe&&(c=Ir)}function Is(e,t,r,n,a){var Z,se,pe,or,cr,lr,me,Be,dr;var s=(n&Xa)!==0,c=t.length,l=e.items,p=e.effect.first,f,h=null,U,_=[],y=[],b,w,m,g;if(s)for(g=0;g<c;g+=1)b=t[g],w=a(b,g),m=l.get(w).e,(m.f&ye)===0&&((se=(Z=m.nodes)==null?void 0:Z.a)==null||se.measure(),(U??(U=new Set)).add(m));for(g=0;g<c;g+=1){if(b=t[g],w=a(b,g),m=l.get(w).e,e.outrogroups!==null)for(const ue of e.outrogroups)ue.pending.delete(m),ue.done.delete(m);if((m.f&ye)!==0)if(m.f^=ye,m===p)zt(m,null,r);else{var S=h?h.next:p;m===e.effect.last&&(e.effect.last=m.prev),m.prev&&(m.prev.next=m.next),m.next&&(m.next.prev=m.prev),be(e,h,m),be(e,m,S),zt(m,S,r),h=m,_=[],y=[],p=h.next;continue}if((m.f&Jr)!==0&&(hi(m),s&&((or=(pe=m.nodes)==null?void 0:pe.a)==null||or.unfix(),(U??(U=new Set)).delete(m))),m!==p){if(f!==void 0&&f.has(m)){if(_.length<y.length){var D=y[0],N;h=D.prev;var P=_[0],O=_[_.length-1];for(N=0;N<_.length;N+=1)zt(_[N],D,r);for(N=0;N<y.length;N+=1)f.delete(y[N]);be(e,P.prev,O.next),be(e,h,P),be(e,O,D),p=D,h=O,g-=1,_=[],y=[]}else f.delete(m),zt(m,p,r),be(e,m.prev,m.next),be(e,m,h===null?e.effect.first:h.next),be(e,h,m),h=m;continue}for(_=[],y=[];p!==null&&p!==m;)(f??(f=new Set)).add(p),y.push(p),p=p.next;if(p===null)continue}(m.f&ye)===0&&_.push(m),h=m,p=m.next}if(e.outrogroups!==null){for(const ue of e.outrogroups)ue.pending.size===0&&(rn(_n(ue.done)),(cr=e.outrogroups)==null||cr.delete(ue));e.outrogroups.size===0&&(e.outrogroups=null)}if(p!==null||f!==void 0){var K=[];if(f!==void 0)for(m of f)(m.f&Jr)===0&&K.push(m);for(;p!==null;)(p.f&Jr)===0&&p!==e.fallback&&K.push(p),p=p.next;var ne=K.length;if(ne>0){var Y=(n&yi)!==0&&c===0?r:null;if(s){for(g=0;g<ne;g+=1)(me=(lr=K[g].nodes)==null?void 0:lr.a)==null||me.measure();for(g=0;g<ne;g+=1)(dr=(Be=K[g].nodes)==null?void 0:Be.a)==null||dr.fix()}_s(e,K,Y)}}s&&In(()=>{var ue,pr;if(U!==void 0)for(m of U)(pr=(ue=m.nodes)==null?void 0:ue.a)==null||pr.apply()})}function xs(e,t,r,n,a,s,c,l){var p=(c&Ha)!==0?(c&Wa)===0?$a(r,!1,!1):kn(r):null,f=(c&Qa)!==0?kn(a):null;return{v:p,i:f,e:tn(()=>(s(t,p??r,f??a,l),()=>{e.delete(n)}))}}function zt(e,t,r){if(e.nodes)for(var n=e.nodes.start,a=e.nodes.end,s=t&&(t.f&ye)===0?t.nodes.start:r;n!==null;){var c=Za(n);if(s.before(n),n===a)return;n=c}}function be(e,t,r){t===null?e.effect.first=r:t.next=r,r===null?e.effect.last=t:r.prev=t}const Us=()=>performance.now(),fe={tick:e=>requestAnimationFrame(e),now:()=>Us(),tasks:new Set};function Ii(){const e=fe.now();fe.tasks.forEach(t=>{t.c(e)||(fe.tasks.delete(t),t.f())}),fe.tasks.size!==0&&fe.tick(Ii)}function Bs(e){let t;return fe.tasks.size===0&&fe.tick(Ii),{promise:new Promise(r=>{fe.tasks.add(t={c:e,f:r})}),abort(){fe.tasks.delete(t)}}}function xr(e,t){vi(()=>{e.dispatchEvent(new CustomEvent(t))})}function Ss(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function qn(e){const t={},r=e.split(";");for(const n of r){const[a,s]=n.split(":");if(!a||s===void 0)break;const c=Ss(a.trim());t[c]=s.trim()}return t}const Ts=e=>e;function zc(e,t,r,n){var m;var a=(e&ns)!==0,s="both",c,l=t.inert,p=t.style.overflow,f,h;function U(){return vi(()=>c??(c=r()(t,(n==null?void 0:n())??{},{direction:s})))}var _={is_global:a,in(){t.inert=l,xr(t,"introstart"),f=nn(t,U(),h,1,()=>{xr(t,"introend"),f==null||f.abort(),f=c=void 0,t.style.overflow=p})},out(g){t.inert=!0,xr(t,"outrostart"),h=nn(t,U(),f,0,()=>{xr(t,"outroend"),g==null||g()})},stop:()=>{f==null||f.abort(),h==null||h.abort()}},y=Ya;if(((m=y.nodes).t??(m.t=[])).push(_),vs){var b=a;if(!b){for(var w=y.parent;w&&(w.f&es)!==0;)for(;(w=w.parent)&&(w.f&ts)===0;);b=!w||(w.f&rs)!==0}b&&gi(()=>{bi(()=>_.in())})}}function nn(e,t,r,n,a){var s=n===1;if(is(t)){var c,l=!1;return In(()=>{if(!l){var m=t({direction:s?"in":"out"});c=nn(e,m,r,n,a)}}),{abort:()=>{l=!0,c==null||c.abort()},deactivate:()=>c.deactivate(),reset:()=>c.reset(),t:()=>c.t()}}if(r==null||r.deactivate(),!(t!=null&&t.duration))return a(),{abort:Ft,deactivate:Ft,reset:Ft,t:()=>n};const{delay:p=0,css:f,tick:h,easing:U=Ts}=t;var _=[];if(s&&r===void 0&&(h&&h(0,1),f)){var y=qn(f(0,1));_.push(y,y)}var b=()=>1-n,w=e.animate(_,{duration:p,fill:"forwards"});return w.onfinish=()=>{w.cancel();var m=(r==null?void 0:r.t())??1-n;r==null||r.abort();var g=n-m,S=t.duration*Math.abs(g),D=[];if(S>0){var N=!1;if(f)for(var P=Math.ceil(S/16.666666666666668),O=0;O<=P;O+=1){var K=m+g*U(O/P),ne=qn(f(K,1-K));D.push(ne),N||(N=ne.overflow==="hidden")}N&&(e.style.overflow="hidden"),b=()=>{var Y=w.currentTime;return m+g*U(Y/S)},h&&Bs(()=>{if(w.playState!=="running")return!1;var Y=b();return h(Y,1-Y),!0})}w=e.animate(D,{duration:S,fill:"forwards"}),w.onfinish=()=>{b=()=>n,h==null||h(n,1-n),a()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=Ft)},deactivate:()=>{a=Ft},reset:()=>{n===0&&(h==null||h(1,0))},t:()=>b()}}const Dn=[...` 	
\r\fÂ \v\uFEFF`];function Ms(e,t,r){var n=e==null?"":""+e;if(t&&(n=n?n+" "+t:t),r){for(var a in r)if(r[a])n=n?n+" "+a:a;else if(n.length)for(var s=a.length,c=0;(c=n.indexOf(a,c))>=0;){var l=c+s;(c===0||Dn.includes(n[c-1]))&&(l===n.length||Dn.includes(n[l]))?n=(c===0?"":n.substring(0,c))+n.substring(l+1):c=l}}return n===""?null:n}function Lc(e,t){return e==null?null:String(e)}function jc(e,t,r,n,a,s){var c=e.__className;if(oe||c!==r||c===void 0){var l=Ms(r,n,s);(!oe||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):e.className=l),e.__className=r}else if(s&&a!==s)for(var p in s){var f=!!s[p];(a==null||f!==!!a[p])&&e.classList.toggle(p,f)}return s}function xi(e,t,r=!1){if(e.multiple){if(t==null)return;if(!mi(t))return as();for(var n of e.options)n.selected=t.includes(Wt(n));return}for(n of e.options){var a=Wt(n);if(ss(a,t)){n.selected=!0;return}}(!r||t!==void 0)&&(e.selectedIndex=-1)}function As(e){var t=new MutationObserver(()=>{xi(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),us(()=>{t.disconnect()})}function Hc(e,t,r=t){var n=new WeakSet,a=!0;wi(e,"change",s=>{var c=s?"[selected]":":checked",l;if(e.multiple)l=[].map.call(e.querySelectorAll(c),Wt);else{var p=e.querySelector(c)??e.querySelector("option:not([disabled])");l=p&&Wt(p)}r(l),he!==null&&n.add(he)}),gi(()=>{var s=t();if(e===document.activeElement){var c=_i??he;if(n.has(c))return}if(xi(e,s,a),a&&s===void 0){var l=e.querySelector(":checked");l!==null&&(s=Wt(l),r(s))}e.__value=s,a=!1}),As(e)}function Wt(e){return"__value"in e?e.__value:e.value}const Cs=Symbol("is custom element"),Es=Symbol("is html");function Wc(e){if(oe){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var n=e.value;Ar(e,"value",null),e.value=n}if(e.hasAttribute("checked")){var a=e.checked;Ar(e,"checked",null),e.checked=a}}};e.__on_r=r,In(r),ps()}}function Ar(e,t,r,n){var a=ks(e);oe&&(a[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||a[t]!==(a[t]=r)&&(t==="loading"&&(e[os]=r),r==null?e.removeAttribute(t):typeof r!="string"&&Rs(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function ks(e){return e.__attributes??(e.__attributes={[Cs]:e.nodeName.includes("-"),[Es]:e.namespaceURI===cs})}var Fn=new Map;function Rs(e){var t=e.getAttribute("is")||e.nodeName,r=Fn.get(t);if(r)return r;Fn.set(t,r=[]);for(var n,a=e,s=Element.prototype;s!==a;){n=ds(a);for(var c in n)n[c].set&&r.push(c);a=ls(a)}return r}function $c(e,t,r=t){var n=new WeakSet;wi(e,"input",async a=>{var s=a?e.defaultValue:e.value;if(s=Zr(e)?Xr(s):s,r(s),he!==null&&n.add(he),await ms(),s!==(s=t())){var c=e.selectionStart,l=e.selectionEnd,p=e.value.length;if(e.value=s??"",l!==null){var f=e.value.length;c===l&&l===p&&f>p?(e.selectionStart=f,e.selectionEnd=f):(e.selectionStart=c,e.selectionEnd=Math.min(l,f))}}}),(oe&&e.defaultValue!==e.value||bi(t)==null&&e.value)&&(r(Zr(e)?Xr(e.value):e.value),he!==null&&n.add(he)),hs(()=>{var a=t();if(e===document.activeElement){var s=_i??he;if(n.has(s))return}Zr(e)&&a===Xr(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function Zr(e){var t=e.type;return t==="number"||t==="range"}function Xr(e){return e===""?null:+e}var Pt={},Pn;function qs(){if(Pn)return Pt;Pn=1,Pt.byteLength=l,Pt.toByteArray=f,Pt.fromByteArray=_;for(var e=[],t=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=n.length;a<s;++a)e[a]=n[a],t[n.charCodeAt(a)]=a;t[45]=62,t[95]=63;function c(y){var b=y.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var w=y.indexOf("=");w===-1&&(w=b);var m=w===b?0:4-w%4;return[w,m]}function l(y){var b=c(y),w=b[0],m=b[1];return(w+m)*3/4-m}function p(y,b,w){return(b+w)*3/4-w}function f(y){var b,w=c(y),m=w[0],g=w[1],S=new r(p(y,m,g)),D=0,N=g>0?m-4:m,P;for(P=0;P<N;P+=4)b=t[y.charCodeAt(P)]<<18|t[y.charCodeAt(P+1)]<<12|t[y.charCodeAt(P+2)]<<6|t[y.charCodeAt(P+3)],S[D++]=b>>16&255,S[D++]=b>>8&255,S[D++]=b&255;return g===2&&(b=t[y.charCodeAt(P)]<<2|t[y.charCodeAt(P+1)]>>4,S[D++]=b&255),g===1&&(b=t[y.charCodeAt(P)]<<10|t[y.charCodeAt(P+1)]<<4|t[y.charCodeAt(P+2)]>>2,S[D++]=b>>8&255,S[D++]=b&255),S}function h(y){return e[y>>18&63]+e[y>>12&63]+e[y>>6&63]+e[y&63]}function U(y,b,w){for(var m,g=[],S=b;S<w;S+=3)m=(y[S]<<16&16711680)+(y[S+1]<<8&65280)+(y[S+2]&255),g.push(h(m));return g.join("")}function _(y){for(var b,w=y.length,m=w%3,g=[],S=16383,D=0,N=w-m;D<N;D+=S)g.push(U(y,D,D+S>N?N:D+S));return m===1?(b=y[w-1],g.push(e[b>>2]+e[b<<4&63]+"==")):m===2&&(b=(y[w-2]<<8)+y[w-1],g.push(e[b>>10]+e[b>>4&63]+e[b<<2&63]+"=")),g.join("")}return Pt}var Ui=qs(),ge,qt=(ge=class{constructor(t){v(this,"__time_duration_micros__");this.__time_duration_micros__=t}static getAlgebraicType(){return x.Product({elements:[{name:"__time_duration_micros__",algebraicType:x.I64}]})}static isTimeDuration(t){if(t.tag!=="Product")return!1;const r=t.value.elements;if(r.length!==1)return!1;const n=r[0];return n.name==="__time_duration_micros__"&&n.algebraicType.tag==="I64"}get micros(){return this.__time_duration_micros__}get millis(){return Number(this.micros/ge.MICROS_PER_MILLIS)}static fromMillis(t){return new ge(BigInt(t)*ge.MICROS_PER_MILLIS)}toString(){const t=this.micros,r=t<0?"-":"+",n=t<0?-t:t,a=n/1000000n,s=n%1000000n;return`${r}${a}.${String(s).padStart(6,"0")}`}},v(ge,"MICROS_PER_MILLIS",1000n),ge),ae,Jt=(ae=class{constructor(t){v(this,"__timestamp_micros_since_unix_epoch__");this.__timestamp_micros_since_unix_epoch__=t}get microsSinceUnixEpoch(){return this.__timestamp_micros_since_unix_epoch__}static getAlgebraicType(){return x.Product({elements:[{name:"__timestamp_micros_since_unix_epoch__",algebraicType:x.I64}]})}static isTimestamp(t){if(t.tag!=="Product")return!1;const r=t.value.elements;if(r.length!==1)return!1;const n=r[0];return n.name==="__timestamp_micros_since_unix_epoch__"&&n.algebraicType.tag==="I64"}static now(){return ae.fromDate(new Date)}toMillis(){return this.microsSinceUnixEpoch/1000n}static fromDate(t){const r=t.getTime(),n=BigInt(r)*ae.MICROS_PER_MILLIS;return new ae(n)}toDate(){const r=this.__timestamp_micros_since_unix_epoch__/ae.MICROS_PER_MILLIS;if(r>BigInt(Number.MAX_SAFE_INTEGER)||r<BigInt(Number.MIN_SAFE_INTEGER))throw new RangeError("Timestamp is outside of the representable range of JS's Date");return new Date(Number(r))}since(t){return new qt(this.__timestamp_micros_since_unix_epoch__-t.__timestamp_micros_since_unix_epoch__)}},v(ae,"MICROS_PER_MILLIS",1000n),v(ae,"UNIX_EPOCH",new ae(0n)),ae),L,Bi=(L=class{constructor(t){v(this,"__uuid__");if(t<0n||t>L.MAX_UUID_BIGINT)throw new Error("Invalid UUID: must be between 0 and `MAX_UUID_BIGINT`");this.__uuid__=t}static fromRandomBytesV4(t){if(t.length!==16)throw new Error("UUID v4 requires 16 bytes");const r=new Uint8Array(t);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,new L(L.bytesToBigInt(r))}static fromCounterV7(t,r,n){if(n.length!==4)throw new Error("`fromCounterV7` requires `randomBytes.length == 4`");if(t.value<0)throw new Error("`fromCounterV7` uuid `counter` must be non-negative");if(r.__timestamp_micros_since_unix_epoch__<0)throw new Error("`fromCounterV7` `timestamp` before unix epoch");const a=t.value;t.value=a+1&2147483647;const s=r.toMillis()&0xffffffffffffn,c=new Uint8Array(16);return c[0]=Number(s>>40n&0xffn),c[1]=Number(s>>32n&0xffn),c[2]=Number(s>>24n&0xffn),c[3]=Number(s>>16n&0xffn),c[4]=Number(s>>8n&0xffn),c[5]=Number(s&0xffn),c[7]=a>>>23&255,c[9]=a>>>15&255,c[10]=a>>>7&255,c[11]=(a&127)<<1&255,c[12]|=n[0]&127,c[13]=n[1],c[14]=n[2],c[15]=n[3],c[6]=c[6]&15|112,c[8]=c[8]&63|128,new L(L.bytesToBigInt(c))}static parse(t){const r=t.replace(/-/g,"");if(r.length!==32)throw new Error("Invalid hex UUID");let n=0n;for(let a=0;a<32;a+=2)n=n<<8n|BigInt(parseInt(r.slice(a,a+2),16));return new L(n)}toString(){const r=[...L.bigIntToBytes(this.__uuid__)].map(n=>n.toString(16).padStart(2,"0")).join("");return r.slice(0,8)+"-"+r.slice(8,12)+"-"+r.slice(12,16)+"-"+r.slice(16,20)+"-"+r.slice(20)}asBigInt(){return this.__uuid__}toBytes(){return L.bigIntToBytes(this.__uuid__)}static bytesToBigInt(t){let r=0n;for(const n of t)r=r<<8n|BigInt(n);return r}static bigIntToBytes(t){const r=new Uint8Array(16);for(let n=15;n>=0;n--)r[n]=Number(t&0xffn),t>>=8n;return r}getVersion(){const t=this.toBytes()[6]>>4&15;switch(t){case 4:return"V4";case 7:return"V7";default:if(this==L.NIL)return"Nil";if(this==L.MAX)return"Max";throw new Error(`Unsupported UUID version: ${t}`)}}getCounter(){const t=this.toBytes(),r=t[7],n=t[9],a=t[10],s=t[11]>>>1;return r<<23|n<<15|a<<7|s|0}compareTo(t){return this.__uuid__<t.__uuid__?-1:this.__uuid__>t.__uuid__?1:0}static getAlgebraicType(){return x.Product({elements:[{name:"__uuid__",algebraicType:x.U128}]})}},v(L,"NIL",new L(0n)),v(L,"MAX_UUID_BIGINT",0xffffffffffffffffffffffffffffffffn),v(L,"MAX",new L(L.MAX_UUID_BIGINT)),L),X,F,B,z,H,ai,We=(ai=class{constructor(e){A(this,z);A(this,X);A(this,F);A(this,B,0);I(this,X,new Uint8Array(e)),I(this,F,new DataView(o(this,X).buffer))}toBase64(){return Ui.fromByteArray(o(this,X).subarray(0,o(this,B)))}getBuffer(){return o(this,X).slice(0,o(this,B))}get offset(){return o(this,B)}writeUInt8Array(e){const t=e.length;T(this,z,H).call(this,4+t),this.writeU32(t),o(this,X).set(e,o(this,B)),I(this,B,o(this,B)+e.length)}writeBool(e){T(this,z,H).call(this,1),o(this,F).setUint8(o(this,B),e?1:0),I(this,B,o(this,B)+1)}writeByte(e){T(this,z,H).call(this,1),o(this,F).setUint8(o(this,B),e),I(this,B,o(this,B)+1)}writeI8(e){T(this,z,H).call(this,1),o(this,F).setInt8(o(this,B),e),I(this,B,o(this,B)+1)}writeU8(e){T(this,z,H).call(this,1),o(this,F).setUint8(o(this,B),e),I(this,B,o(this,B)+1)}writeI16(e){T(this,z,H).call(this,2),o(this,F).setInt16(o(this,B),e,!0),I(this,B,o(this,B)+2)}writeU16(e){T(this,z,H).call(this,2),o(this,F).setUint16(o(this,B),e,!0),I(this,B,o(this,B)+2)}writeI32(e){T(this,z,H).call(this,4),o(this,F).setInt32(o(this,B),e,!0),I(this,B,o(this,B)+4)}writeU32(e){T(this,z,H).call(this,4),o(this,F).setUint32(o(this,B),e,!0),I(this,B,o(this,B)+4)}writeI64(e){T(this,z,H).call(this,8),o(this,F).setBigInt64(o(this,B),e,!0),I(this,B,o(this,B)+8)}writeU64(e){T(this,z,H).call(this,8),o(this,F).setBigUint64(o(this,B),e,!0),I(this,B,o(this,B)+8)}writeU128(e){T(this,z,H).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);o(this,F).setBigUint64(o(this,B),t,!0),o(this,F).setBigUint64(o(this,B)+8,r,!0),I(this,B,o(this,B)+16)}writeI128(e){T(this,z,H).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);o(this,F).setBigInt64(o(this,B),t,!0),o(this,F).setBigInt64(o(this,B)+8,r,!0),I(this,B,o(this,B)+16)}writeU256(e){T(this,z,H).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64)&t,a=e>>BigInt(128)&t,s=e>>BigInt(192);o(this,F).setBigUint64(o(this,B)+0,r,!0),o(this,F).setBigUint64(o(this,B)+8,n,!0),o(this,F).setBigUint64(o(this,B)+16,a,!0),o(this,F).setBigUint64(o(this,B)+24,s,!0),I(this,B,o(this,B)+32)}writeI256(e){T(this,z,H).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64)&t,a=e>>BigInt(128)&t,s=e>>BigInt(192);o(this,F).setBigUint64(o(this,B)+0,r,!0),o(this,F).setBigUint64(o(this,B)+8,n,!0),o(this,F).setBigUint64(o(this,B)+16,a,!0),o(this,F).setBigInt64(o(this,B)+24,s,!0),I(this,B,o(this,B)+32)}writeF32(e){T(this,z,H).call(this,4),o(this,F).setFloat32(o(this,B),e,!0),I(this,B,o(this,B)+4)}writeF64(e){T(this,z,H).call(this,8),o(this,F).setFloat64(o(this,B),e,!0),I(this,B,o(this,B)+8)}writeString(e){const r=new TextEncoder().encode(e);this.writeU32(r.length),T(this,z,H).call(this,r.length),o(this,X).set(r,o(this,B)),I(this,B,o(this,B)+r.length)}},X=new WeakMap,F=new WeakMap,B=new WeakMap,z=new WeakSet,H=function(e){const t=o(this,B)+e+1;if(t<=o(this,X).length)return;let r=o(this,X).length*2;r<t&&(r=t);const n=new Uint8Array(r);n.set(o(this,X)),I(this,X,n),I(this,F,new DataView(o(this,X).buffer))},ai),R,M,Dr,Si,si,Oe=(si=class{constructor(e){A(this,Dr);A(this,R);A(this,M,0);I(this,R,new DataView(e.buffer,e.byteOffset,e.byteLength)),I(this,M,0)}get offset(){return o(this,M)}get remaining(){return o(this,R).byteLength-o(this,M)}readUInt8Array(){const e=this.readU32();return T(this,Dr,Si).call(this,e),this.readBytes(e)}readBool(){const e=o(this,R).getUint8(o(this,M));return I(this,M,o(this,M)+1),e!==0}readByte(){const e=o(this,R).getUint8(o(this,M));return I(this,M,o(this,M)+1),e}readBytes(e){const t=new Uint8Array(o(this,R).buffer,o(this,R).byteOffset+o(this,M),e);return I(this,M,o(this,M)+e),t}readI8(){const e=o(this,R).getInt8(o(this,M));return I(this,M,o(this,M)+1),e}readU8(){return this.readByte()}readI16(){const e=o(this,R).getInt16(o(this,M),!0);return I(this,M,o(this,M)+2),e}readU16(){const e=o(this,R).getUint16(o(this,M),!0);return I(this,M,o(this,M)+2),e}readI32(){const e=o(this,R).getInt32(o(this,M),!0);return I(this,M,o(this,M)+4),e}readU32(){const e=o(this,R).getUint32(o(this,M),!0);return I(this,M,o(this,M)+4),e}readI64(){const e=o(this,R).getBigInt64(o(this,M),!0);return I(this,M,o(this,M)+8),e}readU64(){const e=o(this,R).getBigUint64(o(this,M),!0);return I(this,M,o(this,M)+8),e}readU128(){const e=o(this,R).getBigUint64(o(this,M),!0),t=o(this,R).getBigUint64(o(this,M)+8,!0);return I(this,M,o(this,M)+16),(t<<BigInt(64))+e}readI128(){const e=o(this,R).getBigUint64(o(this,M),!0),t=o(this,R).getBigInt64(o(this,M)+8,!0);return I(this,M,o(this,M)+16),(t<<BigInt(64))+e}readU256(){const e=o(this,R).getBigUint64(o(this,M),!0),t=o(this,R).getBigUint64(o(this,M)+8,!0),r=o(this,R).getBigUint64(o(this,M)+16,!0),n=o(this,R).getBigUint64(o(this,M)+24,!0);return I(this,M,o(this,M)+32),(n<<BigInt(192))+(r<<BigInt(128))+(t<<BigInt(64))+e}readI256(){const e=o(this,R).getBigUint64(o(this,M),!0),t=o(this,R).getBigUint64(o(this,M)+8,!0),r=o(this,R).getBigUint64(o(this,M)+16,!0),n=o(this,R).getBigInt64(o(this,M)+24,!0);return I(this,M,o(this,M)+32),(n<<BigInt(192))+(r<<BigInt(128))+(t<<BigInt(64))+e}readF32(){const e=o(this,R).getFloat32(o(this,M),!0);return I(this,M,o(this,M)+4),e}readF64(){const e=o(this,R).getFloat64(o(this,M),!0);return I(this,M,o(this,M)+8),e}readString(){const e=this.readUInt8Array();return new TextDecoder("utf-8").decode(e)}},R=new WeakMap,M=new WeakMap,Dr=new WeakSet,Si=function(e){if(o(this,M)+e>o(this,R).byteLength)throw new RangeError(`Tried to read ${e} byte(s) at relative offset ${o(this,M)}, but only ${this.remaining} byte(s) remain`)},si);function Zt(e){const t=e.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace("-","").replace("_",""));return t.charAt(0).toUpperCase()+t.slice(1)}function Lt(e,t){if(e===t)return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const a of r)if(!n.includes(a)||!Lt(e[a],t[a]))return!1;return!0}function Ti(e){return Array.prototype.map.call(e.reverse(),t=>("00"+t.toString(16)).slice(-2)).join("")}function Ds(e){if(e.length!=16)throw new Error(`Uint8Array is not 16 bytes long: ${e}`);return new Oe(e).readU128()}function Fs(e){if(e.length!=32)throw new Error(`Uint8Array is not 32 bytes long: [${e}]`);return new Oe(e).readU256()}function Mi(e){e.startsWith("0x")&&(e=e.slice(2));const t=e.match(/.{1,2}/g)||[];return Uint8Array.from(t.map(n=>parseInt(n,16))).reverse()}function Ps(e){return Ds(Mi(e))}function Vs(e){return Fs(Mi(e))}function Ai(e){const t=new We(16);return t.writeU128(e),t.getBuffer()}function Ns(e){return Ti(Ai(e))}function Ci(e){const t=new We(32);return t.writeU256(e),t.getBuffer()}function Os(e){return Ti(Ci(e))}function $t(e){return e.replace(/[-_]+/g,"_").replace(/_([a-zA-Z0-9])/g,(t,r)=>r.toUpperCase())}function Qt(e,t){for(;t.tag==="Ref";)t=e.types[t.value];if(t.tag==="Product"){let n=0;for(const{algebraicType:a}of t.value.elements)n+=Qt(e,a);return n}else if(t.tag==="Sum"){let n=1/0;for(const{algebraicType:a}of t.value.variants){const s=Qt(e,a);s<n&&(n=s)}return n===1/0&&(n=0),4+n}else if(t.tag=="Array")return 4+4*Qt(e,t.value);return{String:8,Sum:1,Bool:1,I8:1,U8:1,I16:2,U16:2,I32:4,U32:4,F32:4,I64:8,U64:8,F64:8,I128:16,U128:16,I256:32,U256:32}[t.tag]}var Ei=class an{constructor(t){v(this,"__identity__");this.__identity__=typeof t=="string"?Vs(t):t}static getAlgebraicType(){return x.Product({elements:[{name:"__identity__",algebraicType:x.U256}]})}isEqual(t){return this.toHexString()===t.toHexString()}equals(t){return this.isEqual(t)}toHexString(){return Os(this.__identity__)}toUint8Array(){return Ci(this.__identity__)}static fromString(t){return new an(t)}static zero(){return new an(0n)}toString(){return this.toHexString()}},x={Ref:e=>({tag:"Ref",value:e}),Sum:e=>({tag:"Sum",value:e}),Product:e=>({tag:"Product",value:e}),Array:e=>({tag:"Array",value:e}),String:{tag:"String"},Bool:{tag:"Bool"},I8:{tag:"I8"},U8:{tag:"U8"},I16:{tag:"I16"},U16:{tag:"U16"},I32:{tag:"I32"},U32:{tag:"U32"},I64:{tag:"I64"},U64:{tag:"U64"},I128:{tag:"I128"},U128:{tag:"U128"},I256:{tag:"I256"},U256:{tag:"U256"},F32:{tag:"F32"},F64:{tag:"F64"},serializeValue(e,t,r,n){if(t.tag==="Ref"){if(!n)throw new Error("cannot serialize refs without a typespace");for(;t.tag==="Ref";)t=n.types[t.value]}switch(t.tag){case"Product":Ke.serializeValue(e,t.value,r,n);break;case"Sum":Vn.serializeValue(e,t.value,r,n);break;case"Array":if(t.value.tag==="U8")e.writeUInt8Array(r);else{const a=t.value;e.writeU32(r.length);for(const s of r)x.serializeValue(e,a,s,n)}break;case"Bool":e.writeBool(r);break;case"I8":e.writeI8(r);break;case"U8":e.writeU8(r);break;case"I16":e.writeI16(r);break;case"U16":e.writeU16(r);break;case"I32":e.writeI32(r);break;case"U32":e.writeU32(r);break;case"I64":e.writeI64(r);break;case"U64":e.writeU64(r);break;case"I128":e.writeI128(r);break;case"U128":e.writeU128(r);break;case"I256":e.writeI256(r);break;case"U256":e.writeU256(r);break;case"F32":e.writeF32(r);break;case"F64":e.writeF64(r);break;case"String":e.writeString(r);break}},deserializeValue:function(e,t,r){if(t.tag==="Ref"){if(!r)throw new Error("cannot deserialize refs without a typespace");for(;t.tag==="Ref";)t=r.types[t.value]}switch(t.tag){case"Product":return Ke.deserializeValue(e,t.value,r);case"Sum":return Vn.deserializeValue(e,t.value,r);case"Array":if(t.value.tag==="U8")return e.readUInt8Array();{const n=t.value,a=e.readU32(),s=[];for(let c=0;c<a;c++)s.push(x.deserializeValue(e,n,r));return s}case"Bool":return e.readBool();case"I8":return e.readI8();case"U8":return e.readU8();case"I16":return e.readI16();case"U16":return e.readU16();case"I32":return e.readI32();case"U32":return e.readU32();case"I64":return e.readI64();case"U64":return e.readU64();case"I128":return e.readI128();case"U128":return e.readU128();case"I256":return e.readI256();case"U256":return e.readU256();case"F32":return e.readF32();case"F64":return e.readF64();case"String":return e.readString()}},intoMapKey:function(e,t){switch(e.tag){case"U8":case"U16":case"U32":case"U64":case"U128":case"U256":case"I8":case"I16":case"I32":case"I64":case"I128":case"I256":case"F32":case"F64":case"String":case"Bool":return t;case"Product":return Ke.intoMapKey(e.value,t);default:{const r=new We(10);return x.serializeValue(r,e,t),r.toBase64()}}}},Ke={serializeValue(e,t,r,n){for(const a of t.elements)x.serializeValue(e,a.algebraicType,r[a.name],n)},deserializeValue(e,t,r){const n={};if(t.elements.length===1){if(t.elements[0].name==="__time_duration_micros__")return new qt(e.readI64());if(t.elements[0].name==="__timestamp_micros_since_unix_epoch__")return new Jt(e.readI64());if(t.elements[0].name==="__identity__")return new Ei(e.readU256());if(t.elements[0].name==="__connection_id__")return new Cr(e.readU128());if(t.elements[0].name==="__uuid__")return new Bi(e.readU128())}for(const a of t.elements)n[a.name]=x.deserializeValue(e,a.algebraicType,r);return n},intoMapKey(e,t){if(e.elements.length===1){if(e.elements[0].name==="__time_duration_micros__")return t.__time_duration_micros__;if(e.elements[0].name==="__timestamp_micros_since_unix_epoch__")return t.__timestamp_micros_since_unix_epoch__;if(e.elements[0].name==="__identity__")return t.__identity__;if(e.elements[0].name==="__connection_id__")return t.__connection_id__;if(e.elements[0].name==="__uuid__")return t.__uuid__}const r=new We(10);return x.serializeValue(r,x.Product(e),t),r.toBase64()}},Vn={serializeValue:function(e,t,r,n){if(t.variants.length==2&&t.variants[0].name==="some"&&t.variants[1].name==="none")r!=null?(e.writeByte(0),x.serializeValue(e,t.variants[0].algebraicType,r,n)):e.writeByte(1);else if(t.variants.length==2&&t.variants[0].name==="ok"&&t.variants[1].name==="err"){let a,s,c;if("ok"in r?(a="ok",s=r.ok,c=0):(a="err",s=r.err,c=1),c<0)throw`Result serialization error: variant '${a}' not found in ${JSON.stringify(t)}`;e.writeU8(c),x.serializeValue(e,t.variants[c].algebraicType,s,n)}else{const a=r.tag,s=t.variants.findIndex(c=>c.name===a);if(s<0)throw`Can't serialize a sum type, couldn't find ${r.tag} tag ${JSON.stringify(r)} in variants ${JSON.stringify(t)}`;e.writeU8(s),x.serializeValue(e,t.variants[s].algebraicType,r.value,n)}},deserializeValue:function(e,t,r){const n=e.readU8();if(t.variants.length==2&&t.variants[0].name==="some"&&t.variants[1].name==="none"){if(n===0)return x.deserializeValue(e,t.variants[0].algebraicType,r);if(n===1)return;throw`Can't deserialize an option type, couldn't find ${n} tag`}else if(t.variants.length==2&&t.variants[0].name==="ok"&&t.variants[1].name==="err"){if(n===0)return{ok:x.deserializeValue(e,t.variants[0].algebraicType,r)};if(n===1)return{err:x.deserializeValue(e,t.variants[1].algebraicType,r)};throw`Can't deserialize a result type, couldn't find ${n} tag`}else{const a=t.variants[n],s=x.deserializeValue(e,a.algebraicType,r);return{tag:a.name,value:s}}}},Cr=class Br{constructor(t){v(this,"__connection_id__");this.__connection_id__=t}static getAlgebraicType(){return x.Product({elements:[{name:"__connection_id__",algebraicType:x.U128}]})}isZero(){return this.__connection_id__===BigInt(0)}static nullIfZero(t){return t.isZero()?null:t}static random(){function t(){return Math.floor(Math.random()*255)}let r=BigInt(0);for(let n=0;n<16;n++)r=r<<BigInt(8)|BigInt(t());return new Br(r)}isEqual(t){return this.__connection_id__==t.__connection_id__}equals(t){return this.isEqual(t)}toHexString(){return Ns(this.__connection_id__)}toUint8Array(){return Ai(this.__connection_id__)}static fromString(t){return new Br(Ps(t))}static fromStringOrNull(t){const r=Br.fromString(t);return r.isZero()?null:r}},Ks={interval(e){return zs(e)},time(e){return Ls(e)},getAlgebraicType(){return x.Sum({variants:[{name:"Interval",algebraicType:qt.getAlgebraicType()},{name:"Time",algebraicType:Jt.getAlgebraicType()}]})},isScheduleAt(e){if(e.tag!=="Sum")return!1;const t=e.value.variants;if(t.length!==2)return!1;const r=t.find(a=>a.name==="Interval"),n=t.find(a=>a.name==="Time");return!r||!n?!1:qt.isTimeDuration(r.algebraicType)&&Jt.isTimestamp(n.algebraicType)}},zs=e=>({tag:"Interval",value:new qt(e)}),Ls=e=>({tag:"Time",value:new Jt(e)}),ki=Ks,js={getAlgebraicType(e){return x.Sum({variants:[{name:"some",algebraicType:e},{name:"none",algebraicType:x.Product({elements:[]})}]})}},Hs={getAlgebraicType(e,t){return x.Sum({variants:[{name:"ok",algebraicType:e},{name:"err",algebraicType:t}]})}};function u(e,t){return{...e,...t}}var k=class{constructor(e){v(this,"type");v(this,"algebraicType");this.algebraicType=e}optional(){return new Er(this)}serialize(e,t){x.serializeValue(e,this.algebraicType,t)}deserialize(e){return x.deserializeValue(e,this.algebraicType)}},Ws=class extends k{constructor(){super(x.U8)}index(e="btree"){return new it(this,u(d,{indexType:e}))}unique(){return new it(this,u(d,{isUnique:!0}))}primaryKey(){return new it(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new it(this,u(d,{isAutoIncrement:!0}))}default(e){return new it(this,u(d,{defaultValue:e}))}name(e){return new it(this,u(d,{name:e}))}},$s=class extends k{constructor(){super(x.U16)}index(e="btree"){return new at(this,u(d,{indexType:e}))}unique(){return new at(this,u(d,{isUnique:!0}))}primaryKey(){return new at(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new at(this,u(d,{isAutoIncrement:!0}))}default(e){return new at(this,u(d,{defaultValue:e}))}name(e){return new at(this,u(d,{name:e}))}},Qs=class extends k{constructor(){super(x.U32)}index(e="btree"){return new st(this,u(d,{indexType:e}))}unique(){return new st(this,u(d,{isUnique:!0}))}primaryKey(){return new st(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new st(this,u(d,{isAutoIncrement:!0}))}default(e){return new st(this,u(d,{defaultValue:e}))}name(e){return new st(this,u(d,{name:e}))}},Gs=class extends k{constructor(){super(x.U64)}index(e="btree"){return new ut(this,u(d,{indexType:e}))}unique(){return new ut(this,u(d,{isUnique:!0}))}primaryKey(){return new ut(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new ut(this,u(d,{isAutoIncrement:!0}))}default(e){return new ut(this,u(d,{defaultValue:e}))}name(e){return new ut(this,u(d,{name:e}))}},Js=class extends k{constructor(){super(x.U128)}index(e="btree"){return new ot(this,u(d,{indexType:e}))}unique(){return new ot(this,u(d,{isUnique:!0}))}primaryKey(){return new ot(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new ot(this,u(d,{isAutoIncrement:!0}))}default(e){return new ot(this,u(d,{defaultValue:e}))}name(e){return new ot(this,u(d,{name:e}))}},Zs=class extends k{constructor(){super(x.U256)}index(e="btree"){return new ct(this,u(d,{indexType:e}))}unique(){return new ct(this,u(d,{isUnique:!0}))}primaryKey(){return new ct(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new ct(this,u(d,{isAutoIncrement:!0}))}default(e){return new ct(this,u(d,{defaultValue:e}))}name(e){return new ct(this,u(d,{name:e}))}},Xs=class extends k{constructor(){super(x.I8)}index(e="btree"){return new lt(this,u(d,{indexType:e}))}unique(){return new lt(this,u(d,{isUnique:!0}))}primaryKey(){return new lt(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new lt(this,u(d,{isAutoIncrement:!0}))}default(e){return new lt(this,u(d,{defaultValue:e}))}name(e){return new lt(this,u(d,{name:e}))}},Ys=class extends k{constructor(){super(x.I16)}index(e="btree"){return new dt(this,u(d,{indexType:e}))}unique(){return new dt(this,u(d,{isUnique:!0}))}primaryKey(){return new dt(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new dt(this,u(d,{isAutoIncrement:!0}))}default(e){return new dt(this,u(d,{defaultValue:e}))}name(e){return new dt(this,u(d,{name:e}))}},eu=class extends k{constructor(){super(x.I32)}index(e="btree"){return new pt(this,u(d,{indexType:e}))}unique(){return new pt(this,u(d,{isUnique:!0}))}primaryKey(){return new pt(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new pt(this,u(d,{isAutoIncrement:!0}))}default(e){return new pt(this,u(d,{defaultValue:e}))}name(e){return new pt(this,u(d,{name:e}))}},tu=class extends k{constructor(){super(x.I64)}index(e="btree"){return new mt(this,u(d,{indexType:e}))}unique(){return new mt(this,u(d,{isUnique:!0}))}primaryKey(){return new mt(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new mt(this,u(d,{isAutoIncrement:!0}))}default(e){return new mt(this,u(d,{defaultValue:e}))}name(e){return new mt(this,u(d,{name:e}))}},ru=class extends k{constructor(){super(x.I128)}index(e="btree"){return new ht(this,u(d,{indexType:e}))}unique(){return new ht(this,u(d,{isUnique:!0}))}primaryKey(){return new ht(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new ht(this,u(d,{isAutoIncrement:!0}))}default(e){return new ht(this,u(d,{defaultValue:e}))}name(e){return new ht(this,u(d,{name:e}))}},nu=class extends k{constructor(){super(x.I256)}index(e="btree"){return new ft(this,u(d,{indexType:e}))}unique(){return new ft(this,u(d,{isUnique:!0}))}primaryKey(){return new ft(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new ft(this,u(d,{isAutoIncrement:!0}))}default(e){return new ft(this,u(d,{defaultValue:e}))}name(e){return new ft(this,u(d,{name:e}))}},iu=class extends k{constructor(){super(x.F32)}default(e){return new On(this,u(d,{defaultValue:e}))}name(e){return new On(this,u(d,{name:e}))}},Nn=class extends k{constructor(){super(x.F64)}default(e){return new Kn(this,u(d,{defaultValue:e}))}name(e){return new Kn(this,u(d,{name:e}))}},au=class extends k{constructor(){super(x.Bool)}index(e="btree"){return new Vt(this,u(d,{indexType:e}))}unique(){return new Vt(this,u(d,{isUnique:!0}))}primaryKey(){return new Vt(this,u(d,{isPrimaryKey:!0}))}default(e){return new Vt(this,u(d,{defaultValue:e}))}name(e){return new Vt(this,u(d,{name:e}))}},su=class extends k{constructor(){super(x.String)}index(e="btree"){return new Nt(this,u(d,{indexType:e}))}unique(){return new Nt(this,u(d,{isUnique:!0}))}primaryKey(){return new Nt(this,u(d,{isPrimaryKey:!0}))}default(e){return new Nt(this,u(d,{defaultValue:e}))}name(e){return new Nt(this,u(d,{name:e}))}},sn=class extends k{constructor(t){super(x.Array(t.algebraicType));v(this,"element");this.element=t}default(t){return new zn(this.element,u(d,{defaultValue:t}))}name(t){return new zn(this.element,u(d,{name:t}))}},uu=class extends k{constructor(){super(x.Array(x.U8))}default(e){return new Ln(u(d,{defaultValue:e}))}name(e){return new Ln(u(d,{name:e}))}},Er=class extends k{constructor(t){super(js.getAlgebraicType(t.algebraicType));v(this,"value");this.value=t}default(t){return new jn(this,u(d,{defaultValue:t}))}name(t){return new jn(this,u(d,{name:t}))}},Dt=class extends k{constructor(t,r){function n(a){return Object.keys(a).map(s=>({name:s,get algebraicType(){return a[s].algebraicType}}))}super(x.Product({elements:n(t)}));v(this,"typeName");v(this,"elements");this.typeName=r,this.elements=t}default(t){return new Hn(this,u(d,{defaultValue:t}))}name(t){return new Hn(this,u(d,{name:t}))}},un=class extends k{constructor(t,r){super(Hs.getAlgebraicType(t.algebraicType,r.algebraicType));v(this,"ok");v(this,"err");this.ok=t,this.err=r}default(t){return new fu(this,u(d,{defaultValue:t}))}},xn=class extends k{constructor(){super({tag:"Product",value:{elements:[]}})}},le=class extends k{constructor(t,r){const n=Object.fromEntries(Object.entries(t).map(([s,c])=>[s,c instanceof q?c:new q(c,{})])),a=Object.keys(n).map(s=>({name:s,get algebraicType(){return n[s].typeBuilder.algebraicType}}));super(x.Product({elements:a}));v(this,"row");v(this,"typeName");this.row=n,this.typeName=r}},Ri=class extends k{constructor(t,r){function n(a){return Object.keys(a).map(s=>({name:s,get algebraicType(){return a[s].algebraicType}}))}super(x.Sum({variants:n(t)}));v(this,"variants");v(this,"typeName");this.variants=t,this.typeName=r;for(const a of Object.keys(t)){const s=Object.getOwnPropertyDescriptor(t,a),c=!!s&&(typeof s.get=="function"||typeof s.set=="function");let l=!1;if(c||(l=t[a]instanceof xn),l){const p=this.create(a);Object.defineProperty(this,a,{value:p,writable:!1,enumerable:!0,configurable:!1})}else Object.defineProperty(this,a,{value:(f=>this.create(a,f)),writable:!1,enumerable:!0,configurable:!1})}}create(t,r){return r===void 0?{tag:t}:{tag:t,value:r}}default(t){return new hn(this,u(d,{defaultValue:t}))}name(t){return new hn(this,u(d,{name:t}))}},Un=Ri,ou=class extends Ri{index(e="btree"){return new Wn(this,u(d,{indexType:e}))}primaryKey(){return new Wn(this,u(d,{isPrimaryKey:!0}))}},cu=class extends k{constructor(){super(ki.getAlgebraicType())}default(e){return new $n(this,u(d,{defaultValue:e}))}name(e){return new $n(this,u(d,{name:e}))}},lu=class extends k{constructor(){super(Ei.getAlgebraicType())}index(e="btree"){return new yt(this,u(d,{indexType:e}))}unique(){return new yt(this,u(d,{isUnique:!0}))}primaryKey(){return new yt(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new yt(this,u(d,{isAutoIncrement:!0}))}default(e){return new yt(this,u(d,{defaultValue:e}))}name(e){return new yt(this,u(d,{name:e}))}},du=class extends k{constructor(){super(Cr.getAlgebraicType())}index(e="btree"){return new gt(this,u(d,{indexType:e}))}unique(){return new gt(this,u(d,{isUnique:!0}))}primaryKey(){return new gt(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new gt(this,u(d,{isAutoIncrement:!0}))}default(e){return new gt(this,u(d,{defaultValue:e}))}name(e){return new gt(this,u(d,{name:e}))}},pu=class extends k{constructor(){super(Jt.getAlgebraicType())}index(e="btree"){return new bt(this,u(d,{indexType:e}))}unique(){return new bt(this,u(d,{isUnique:!0}))}primaryKey(){return new bt(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new bt(this,u(d,{isAutoIncrement:!0}))}default(e){return new bt(this,u(d,{defaultValue:e}))}name(e){return new bt(this,u(d,{name:e}))}},mu=class extends k{constructor(){super(qt.getAlgebraicType())}index(e="btree"){return new vt(this,u(d,{indexType:e}))}unique(){return new vt(this,u(d,{isUnique:!0}))}primaryKey(){return new vt(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new vt(this,u(d,{isAutoIncrement:!0}))}default(e){return new vt(this,u(d,{defaultValue:e}))}name(e){return new vt(this,u(d,{name:e}))}},hu=class extends k{constructor(){super(Bi.getAlgebraicType())}index(e="btree"){return new Ot(this,u(d,{indexType:e}))}unique(){return new Ot(this,u(d,{isUnique:!0}))}primaryKey(){return new Ot(this,u(d,{isPrimaryKey:!0}))}autoInc(){return new Ot(this,u(d,{isAutoIncrement:!0}))}default(e){return new Ot(this,u(d,{defaultValue:e}))}},d={},q=class{constructor(e,t){v(this,"typeBuilder");v(this,"columnMetadata");this.typeBuilder=e,this.columnMetadata=t}serialize(e,t){x.serializeValue(e,this.typeBuilder.algebraicType,t)}deserialize(e){return x.deserializeValue(e,this.typeBuilder.algebraicType)}},it=class Te extends q{index(t="btree"){return new Te(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Te(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Te(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Te(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Te(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Te(this.typeBuilder,u(this.columnMetadata,{name:t}))}},at=class Me extends q{index(t="btree"){return new Me(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Me(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Me(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Me(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Me(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Me(this.typeBuilder,u(this.columnMetadata,{name:t}))}},st=class Ae extends q{index(t="btree"){return new Ae(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Ae(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Ae(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Ae(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Ae(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Ae(this.typeBuilder,u(this.columnMetadata,{name:t}))}},ut=class Ce extends q{index(t="btree"){return new Ce(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Ce(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Ce(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Ce(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Ce(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Ce(this.typeBuilder,u(this.columnMetadata,{name:t}))}},ot=class Ee extends q{index(t="btree"){return new Ee(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Ee(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Ee(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Ee(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Ee(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Ee(this.typeBuilder,u(this.columnMetadata,{name:t}))}},ct=class ke extends q{index(t="btree"){return new ke(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new ke(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new ke(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new ke(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new ke(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new ke(this.typeBuilder,u(this.columnMetadata,{name:t}))}},lt=class Re extends q{index(t="btree"){return new Re(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Re(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Re(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Re(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Re(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Re(this.typeBuilder,u(this.columnMetadata,{name:t}))}},dt=class qe extends q{index(t="btree"){return new qe(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new qe(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new qe(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new qe(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new qe(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new qe(this.typeBuilder,u(this.columnMetadata,{name:t}))}},pt=class De extends q{index(t="btree"){return new De(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new De(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new De(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new De(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new De(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new De(this.typeBuilder,u(this.columnMetadata,{name:t}))}},mt=class Fe extends q{index(t="btree"){return new Fe(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Fe(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Fe(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Fe(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Fe(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Fe(this.typeBuilder,u(this.columnMetadata,{name:t}))}},ht=class Pe extends q{index(t="btree"){return new Pe(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Pe(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Pe(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Pe(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Pe(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Pe(this.typeBuilder,u(this.columnMetadata,{name:t}))}},ft=class Ve extends q{index(t="btree"){return new Ve(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Ve(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Ve(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new Ve(this.typeBuilder,u(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new Ve(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Ve(this.typeBuilder,u(this.columnMetadata,{name:t}))}},On=class on extends q{default(t){return new on(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new on(this.typeBuilder,u(this.columnMetadata,{name:t}))}},Kn=class cn extends q{default(t){return new cn(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new cn(this.typeBuilder,u(this.columnMetadata,{name:t}))}},Vt=class wt extends q{index(t="btree"){return new wt(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new wt(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new wt(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new wt(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new wt(this.typeBuilder,u(this.columnMetadata,{name:t}))}},Nt=class _t extends q{index(t="btree"){return new _t(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new _t(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new _t(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new _t(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new _t(this.typeBuilder,u(this.columnMetadata,{name:t}))}},zn=class ln extends q{default(t){return new ln(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new ln(this.typeBuilder,u(this.columnMetadata,{name:t}))}},Ln=class dn extends q{constructor(t){super(new k(x.Array(x.U8)),t)}default(t){return new dn(u(this.columnMetadata,{defaultValue:t}))}name(t){return new dn(u(this.columnMetadata,{name:t}))}},jn=class pn extends q{default(t){return new pn(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new pn(this.typeBuilder,u(this.columnMetadata,{name:t}))}},fu=class qi extends q{constructor(t,r){super(t,r)}default(t){return new qi(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}},Hn=class mn extends q{default(t){return new mn(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new mn(this.typeBuilder,u(this.columnMetadata,{name:t}))}},hn=class fn extends q{default(t){return new fn(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new fn(this.typeBuilder,u(this.columnMetadata,{name:t}))}},Wn=class yn extends hn{index(t="btree"){return new yn(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}primaryKey(){return new yn(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}},$n=class gn extends q{default(t){return new gn(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new gn(this.typeBuilder,u(this.columnMetadata,{name:t}))}},yt=class It extends q{index(t="btree"){return new It(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new It(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new It(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new It(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new It(this.typeBuilder,u(this.columnMetadata,{name:t}))}},gt=class xt extends q{index(t="btree"){return new xt(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new xt(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new xt(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new xt(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new xt(this.typeBuilder,u(this.columnMetadata,{name:t}))}},bt=class Ut extends q{index(t="btree"){return new Ut(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Ut(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Ut(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new Ut(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Ut(this.typeBuilder,u(this.columnMetadata,{name:t}))}},vt=class Bt extends q{index(t="btree"){return new Bt(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new Bt(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new Bt(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new Bt(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}name(t){return new Bt(this.typeBuilder,u(this.columnMetadata,{name:t}))}},Ot=class jt extends q{index(t="btree"){return new jt(this.typeBuilder,u(this.columnMetadata,{indexType:t}))}unique(){return new jt(this.typeBuilder,u(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new jt(this.typeBuilder,u(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new jt(this.typeBuilder,u(this.columnMetadata,{defaultValue:t}))}},yu=class extends k{constructor(t){super(x.Ref(t));v(this,"ref");v(this,"__spacetimeType");this.ref=t}},gu=((e,t)=>{let r=e,n;if(typeof e=="string"){if(!t)throw new TypeError("When providing a name, you must also provide the variants object or array.");r=t,n=e}if(Array.isArray(r)){const a={};for(const s of r)a[s]=new xn;return new ou(a,n)}return new Un(r,n)}),i={bool:()=>new au,string:()=>new su,number:()=>new Nn,i8:()=>new Xs,u8:()=>new Ws,i16:()=>new Ys,u16:()=>new $s,i32:()=>new eu,u32:()=>new Qs,i64:()=>new tu,u64:()=>new Gs,i128:()=>new ru,u128:()=>new Js,i256:()=>new nu,u256:()=>new Zs,f32:()=>new iu,f64:()=>new Nn,object:((e,t)=>{if(typeof e=="string"){if(!t)throw new TypeError("When providing a name, you must also provide the object.");return new Dt(t,e)}return new Dt(e,void 0)}),row:((e,t)=>{const[r,n]=typeof e=="string"?[t,e]:[e,void 0];return new le(r,n)}),array(e){return new sn(e)},enum:gu,unit(){return new xn},lazy(e){let t=null;const r=()=>t??(t=e());return new Proxy({},{get(a,s,c){const l=r(),p=Reflect.get(l,s,c);return typeof p=="function"?p.bind(l):p},set(a,s,c,l){return Reflect.set(r(),s,c,l)},has(a,s){return s in r()},ownKeys(){return Reflect.ownKeys(r())},getOwnPropertyDescriptor(a,s){return Object.getOwnPropertyDescriptor(r(),s)},getPrototypeOf(){return Object.getPrototypeOf(r())}})},scheduleAt:()=>new cu,option(e){return new Er(e)},result(e,t){return new un(e,t)},identity:()=>new lu,connectionId:()=>new du,timestamp:()=>new pu,timeDuration:()=>new mu,uuid:()=>new hu,byteArray:()=>new uu},bu=i.enum("RowSizeHint",{FixedSize:i.u16(),RowOffsets:i.array(i.u64())}),vu=bu,bn=i.object("BsatnRowList",{get sizeHint(){return vu},rowsData:i.byteArray()}),wu=i.object("CallReducer",{reducer:i.string(),args:i.byteArray(),requestId:i.u32(),flags:i.u8()}),_u=i.object("Subscribe",{queryStrings:i.array(i.string()),requestId:i.u32()}),Iu=i.object("OneOffQuery",{messageId:i.byteArray(),queryString:i.string()}),Ue=i.object("QueryId",{id:i.u32()}),xu=i.object("SubscribeSingle",{query:i.string(),requestId:i.u32(),get queryId(){return Ue}}),Uu=i.object("SubscribeMulti",{queryStrings:i.array(i.string()),requestId:i.u32(),get queryId(){return Ue}}),Bu=i.object("Unsubscribe",{requestId:i.u32(),get queryId(){return Ue}}),Su=i.object("UnsubscribeMulti",{requestId:i.u32(),get queryId(){return Ue}}),Tu=i.object("CallProcedure",{procedure:i.string(),args:i.byteArray(),requestId:i.u32(),flags:i.u8()}),Mu=i.enum("ClientMessage",{get CallReducer(){return wu},get Subscribe(){return _u},get OneOffQuery(){return Iu},get SubscribeSingle(){return xu},get SubscribeMulti(){return Uu},get Unsubscribe(){return Bu},get UnsubscribeMulti(){return Su},get CallProcedure(){return Tu}}),Kt=Mu,Di=i.object("QueryUpdate",{get deletes(){return bn},get inserts(){return bn}}),Au=i.enum("CompressableQueryUpdate",{get Uncompressed(){return Di},Brotli:i.byteArray(),Gzip:i.byteArray()}),Cu=Au,Fi=i.object("TableUpdate",{tableId:i.u32(),tableName:i.string(),numRows:i.u64(),get updates(){return i.array(Cu)}}),ur=i.object("DatabaseUpdate",{get tables(){return i.array(Fi)}}),Eu=i.object("InitialSubscription",{get databaseUpdate(){return ur},requestId:i.u32(),totalHostExecutionDuration:i.timeDuration()}),ku=i.enum("UpdateStatus",{get Committed(){return ur},Failed:i.string(),OutOfEnergy:i.unit()}),Ru=ku,qu=i.object("ReducerCallInfo",{reducerName:i.string(),reducerId:i.u32(),args:i.byteArray(),requestId:i.u32()}),Du=i.object("EnergyQuanta",{quanta:i.u128()}),Fu=i.object("TransactionUpdate",{get status(){return Ru},timestamp:i.timestamp(),callerIdentity:i.identity(),callerConnectionId:i.connectionId(),get reducerCall(){return qu},get energyQuantaUsed(){return Du},totalHostExecutionDuration:i.timeDuration()}),Pu=i.object("TransactionUpdateLight",{requestId:i.u32(),get update(){return ur}}),Vu=i.object("IdentityToken",{identity:i.identity(),token:i.string(),connectionId:i.connectionId()}),Nu=i.object("OneOffTable",{tableName:i.string(),get rows(){return bn}}),Ou=i.object("OneOffQueryResponse",{messageId:i.byteArray(),error:i.option(i.string()),get tables(){return i.array(Nu)},totalHostExecutionDuration:i.timeDuration()}),Pi=i.object("SubscribeRows",{tableId:i.u32(),tableName:i.string(),get tableRows(){return Fi}}),Ku=i.object("SubscribeApplied",{requestId:i.u32(),totalHostExecutionDurationMicros:i.u64(),get queryId(){return Ue},get rows(){return Pi}}),zu=i.object("UnsubscribeApplied",{requestId:i.u32(),totalHostExecutionDurationMicros:i.u64(),get queryId(){return Ue},get rows(){return Pi}}),Lu=i.object("SubscriptionError",{totalHostExecutionDurationMicros:i.u64(),requestId:i.option(i.u32()),queryId:i.option(i.u32()),tableId:i.option(i.u32()),error:i.string()}),ju=i.object("SubscribeMultiApplied",{requestId:i.u32(),totalHostExecutionDurationMicros:i.u64(),get queryId(){return Ue},get update(){return ur}}),Hu=i.object("UnsubscribeMultiApplied",{requestId:i.u32(),totalHostExecutionDurationMicros:i.u64(),get queryId(){return Ue},get update(){return ur}}),Wu=i.enum("ProcedureStatus",{Returned:i.byteArray(),OutOfEnergy:i.unit(),InternalError:i.string()}),$u=Wu,Qu=i.object("ProcedureResult",{get status(){return $u},timestamp:i.timestamp(),totalHostExecutionDuration:i.timeDuration(),requestId:i.u32()}),Gu=i.enum("ServerMessage",{get InitialSubscription(){return Eu},get TransactionUpdate(){return Fu},get TransactionUpdateLight(){return Pu},get IdentityToken(){return Vu},get OneOffQueryResponse(){return Ou},get SubscribeApplied(){return Ku},get UnsubscribeApplied(){return zu},get SubscriptionError(){return Lu},get SubscribeMultiApplied(){return ju},get UnsubscribeMultiApplied(){return Hu},get ProcedureResult(){return Qu}}),Ju=Gu,ze,ui,Lr=(ui=class{constructor(){A(this,ze,new Map)}on(e,t){let r=o(this,ze).get(e);r||(r=new Set,o(this,ze).set(e,r)),r.add(t)}off(e,t){const r=o(this,ze).get(e);r&&r.delete(t)}emit(e,...t){const r=o(this,ze).get(e);if(r)for(const n of r)n(...t)}},ze=new WeakMap,ui),Zu={component:"ð¦",info:"â¹ï¸",warn:"â ï¸",error:"â",debug:"ð"},Xu={component:"color: #fff; background-color: #8D6FDD; padding: 2px 5px; border-radius: 3px;",info:"color: #fff; background-color: #007bff; padding: 2px 5px; border-radius: 3px;",warn:"color: #fff; background-color: #ffc107; padding: 2px 5px; border-radius: 3px;",error:"color: #fff; background-color: #dc3545; padding: 2px 5px; border-radius: 3px;",debug:"color: #fff; background-color: #28a745; padding: 2px 5px; border-radius: 3px;"},Yu={component:"color: #8D6FDD;",info:"color: #007bff;",warn:"color: #ffc107;",error:"color: #dc3545;",debug:"color: #28a745;"},xe=(e,t)=>{console.log(`%c${Zu[e]} ${e.toUpperCase()}%c ${t}`,Xu[e],Yu[e])},Qn=(e,t)=>e===t?0:e<t?-1:1,Fr,Vi,oi,eo=(oi=class{constructor(e){A(this,Fr);v(this,"rows");v(this,"tableDef");v(this,"emitter");v(this,"applyOperations",(e,t)=>{const r=[];if(Object.values(this.tableDef.columns).some(a=>a.columnMetadata.isPrimaryKey===!0)){const a=new Map,s=new Map;for(const c of e)if(c.type==="insert"){const[l,p]=a.get(c.rowId)||[c,0];a.set(c.rowId,[c,p+1])}else{const[l,p]=s.get(c.rowId)||[c,0];s.set(c.rowId,[c,p+1])}for(const[c,[l,p]]of a){const f=s.get(c);if(f){const[h,U]=f,_=p-U,y=this.update(t,c,l.row,_);y&&r.push(y),s.delete(c)}else{const h=this.insert(t,l,p);h&&r.push(h)}}for(const[c,l]of s.values()){const p=this.delete(t,c,l);p&&r.push(p)}}else for(const a of e)if(a.type==="insert"){const s=this.insert(t,a);s&&r.push(s)}else{const s=this.delete(t,a);s&&r.push(s)}return r});v(this,"update",(e,t,r,n=0)=>{const a=this.rows.get(t);if(!a){xe("error",`Updating a row that was not present in the cache. Table: ${this.tableDef.name}, RowId: ${t}`);return}const[s,c]=a,l=Math.max(1,c+n);if(c+n<=0){xe("error",`Negative reference count for in table ${this.tableDef.name} row ${t} (${c} + ${n})`);return}return this.rows.set(t,[r,l]),c===0?(xe("error",`Updating a row id in table ${this.tableDef.name} which was not present in the cache (rowId: ${t})`),{type:"insert",table:this.tableDef.name,cb:()=>{this.emitter.emit("insert",e,r)}}):{type:"update",table:this.tableDef.name,cb:()=>{this.emitter.emit("update",e,s,r)}}});v(this,"insert",(e,t,r=1)=>{const[n,a]=this.rows.get(t.rowId)||[t.row,0];if(this.rows.set(t.rowId,[t.row,a+r]),a===0)return{type:"insert",table:this.tableDef.name,cb:()=>{this.emitter.emit("insert",e,t.row)}}});v(this,"delete",(e,t,r=1)=>{const[n,a]=this.rows.get(t.rowId)||[t.row,0];if(a===0){xe("warn","Deleting a row that was not present in the cache");return}if(a<=r)return this.rows.delete(t.rowId),{type:"delete",table:this.tableDef.name,cb:()=>{this.emitter.emit("delete",e,t.row)}};this.rows.set(t.rowId,[t.row,a-r])});v(this,"onInsert",e=>{this.emitter.on("insert",e)});v(this,"onDelete",e=>{this.emitter.on("delete",e)});v(this,"onUpdate",e=>{this.emitter.on("update",e)});v(this,"removeOnInsert",e=>{this.emitter.off("insert",e)});v(this,"removeOnDelete",e=>{this.emitter.off("delete",e)});v(this,"removeOnUpdate",e=>{this.emitter.off("update",e)});this.tableDef=e,this.rows=new Map,this.emitter=new Lr;const t=this.tableDef.indexes||[];for(const r of t){const n=r,a=T(this,Fr,Vi).call(this,this.tableDef,n);this[r.name]=a}}count(){return BigInt(this.rows.size)}iter(){function*e(t){for(const[r]of t.values())yield r}return e(this.rows)}[Symbol.iterator](){return this.iter()}},Fr=new WeakSet,Vi=function(e,t){if(t.algorithm!=="btree")throw new Error("Only btree indexes are supported in TableCacheImpl");const r=t.columns,n=l=>r.map(p=>l[p]),a=(l,p)=>{const f=n(l),h=Array.isArray(p)?p:[p],U=Math.max(0,h.length-1);for(let b=0;b<U;b++)if(!Lt(f[b],h[b]))return!1;const _=h[h.length-1],y=f[U];if(_&&typeof _=="object"&&"from"in _&&"to"in _){const b=_.from,w=_.to;if(b.tag!=="unbounded"){const m=Qn(y,b.value);if(m<0||m===0&&b.tag==="excluded")return!1}if(w.tag!=="unbounded"){const m=Qn(y,w.value);if(m>0||m===0&&w.tag==="excluded")return!1}return!0}else return!!Lt(y,_)},s=e.constraints.some(l=>l.constraint!=="unique"?!1:Lt(l.columns,t.columns)),c=this;return s?{find:p=>{const f=Array.isArray(p)?p:[p];for(const h of c.iter())if(Lt(n(h),f))return h;return null}}:{*filter(p){for(const f of c.iter())a(f,p)&&(yield f)}}},oi),to=class{constructor(){v(this,"map",new Map)}get(e){return this.map.get(e)}set(e,t){return this.map.set(e,t),this}has(e){return this.map.has(e)}delete(e){return this.map.delete(e)}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.entries()}},ro=class{constructor(){v(this,"tables",new to)}getTable(e){const t=this.tables.get(e);if(!t)throw console.error("The table has not been registered for this client. Please register the table before using it. If you have registered global tables using the SpacetimeDBClient.registerTables() or `registerTable()` method, please make sure that is executed first!"),new Error(`Table ${String(e)} does not exist`);return t}getOrCreateTable(e){const t=e.name,r=this.tables.get(t);if(r)return r;const n=new eo(e);return this.tables.set(t,n),n}};function no(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const a=e[n],s=t[n];if(a!==s)return typeof a=="number"&&typeof s=="number"?a-s:typeof a=="string"&&typeof s=="string"?a.localeCompare(s):typeof a=="string"?1:-1}return e.length-t.length}var Ni=class vn{constructor(t,r,n,a=null,s=null){v(this,"major");v(this,"minor");v(this,"patch");v(this,"preRelease");v(this,"buildInfo");this.major=t,this.minor=r,this.patch=n,this.preRelease=a,this.buildInfo=s}toString(){let t=`${this.major}.${this.minor}.${this.patch}`;return this.preRelease&&(t+=`-${this.preRelease.join(".")}`),this.buildInfo&&(t+=`+${this.buildInfo}`),t}compare(t){return this.major!==t.major?this.major-t.major:this.minor!==t.minor?this.minor-t.minor:this.patch!==t.patch?this.patch-t.patch:this.preRelease&&t.preRelease?no(this.preRelease,t.preRelease):this.preRelease||t.preRelease?-1:0}clone(){return new vn(this.major,this.minor,this.patch,this.preRelease?[...this.preRelease]:null,this.buildInfo)}static parseVersionString(t){const r=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?(?:\+([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?$/,n=t.match(r);if(!n)throw new Error(`Invalid version string: ${t}`);const a=parseInt(n[1],10),s=parseInt(n[2],10),c=parseInt(n[3],10),l=n[4]?n[4].split(".").map(f=>isNaN(Number(f))?f:Number(f)):null,p=n[5]||null;return new vn(a,s,c,l,p)}},Oi=new Ni(1,4,0);function io(e){if(e===void 0)throw new Error(Gn(e));if(Ni.parseVersionString(e).compare(Oi)<0)throw new Error(Gn(e))}function Gn(e){return`Module code was generated with an incompatible version of the spacetimedb cli (${e}). Update the cli version to at least ${Oi.toString()} and regenerate the bindings. You can upgrade to the latest cli version by running: spacetime version upgrade`}async function Ki(e,t,r=128*1024){let n=0;const a=new ReadableStream({pull(y){if(n<e.length){const b=e.subarray(n,Math.min(n+r,e.length));y.enqueue(b),n+=r}else y.close()}}),s=new DecompressionStream(t),l=a.pipeThrough(s).getReader(),p=[];let f=0,h;for(;!(h=await l.read()).done;)p.push(h.value),f+=h.value.length;const U=new Uint8Array(f);let _=0;for(const y of p)U.set(y,_),_+=y.length;return U}async function ao(){if(typeof globalThis.WebSocket<"u")return globalThis.WebSocket;const e=new Function("m","return import(m)");try{const{WebSocket:t}=await e("undici");return t}catch(t){throw console.warn("[spacetimedb-sdk] No global WebSocket found. On Node 18â21, please install `undici` (npm install undici) to enable WebSocket support."),t}}var St,de,zi,Li,ji,Hi,Tt,so=(Tt=class{constructor(t){A(this,de);v(this,"onclose");v(this,"onopen");v(this,"onmessage");v(this,"onerror");A(this,St);this.onmessage=void 0,this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,t.onmessage=T(this,de,zi).bind(this),t.onerror=T(this,de,ji).bind(this),t.onclose=T(this,de,Hi).bind(this),t.onopen=T(this,de,Li).bind(this),t.binaryType="arraybuffer",I(this,St,t)}send(t){o(this,St).send(t)}close(){o(this,St).close()}static async createWebSocketFn({url:t,nameOrAddress:r,wsProtocol:n,authToken:a,compression:s,lightMode:c,confirmedReads:l}){const p=new Headers,f=await ao();let h;if(a){p.set("Authorization",`Bearer ${a}`);const y=new URL("v1/identity/websocket-token",t);y.protocol=t.protocol==="wss:"?"https:":"http:";const b=await fetch(y,{method:"POST",headers:p});if(b.ok){const{token:w}=await b.json();h=w}else return Promise.reject(new Error(`Failed to verify token: ${b.statusText}`))}const U=new URL(`v1/database/${r}/subscribe`,t);h&&U.searchParams.set("token",h),U.searchParams.set("compression",s==="gzip"?"Gzip":"None"),c&&U.searchParams.set("light","true"),l!==void 0&&U.searchParams.set("confirmed",l.toString());const _=new f(U.toString(),n);return new Tt(_)}},St=new WeakMap,de=new WeakSet,zi=async function(t){var a;const r=new Uint8Array(t.data);let n;if(r[0]===0)n=r.slice(1);else{if(r[0]===1)throw new Error("Brotli Compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");if(r[0]===2)n=await Ki(r.slice(1),"gzip");else throw new Error("Unexpected Compression Algorithm. Please use `gzip` or `none`")}(a=this.onmessage)==null||a.call(this,{data:n})},Li=function(t){var r;(r=this.onopen)==null||r.call(this,t)},ji=function(t){var r;(r=this.onerror)==null||r.call(this,t)},Hi=function(t){var r;(r=this.onclose)==null||r.call(this,t)},Tt),Mt,At,Pr,Xt,Le,Yt,er,tr,Ct,ci,uo=(ci=class{constructor(t,r){A(this,Mt);A(this,At);A(this,Pr);A(this,Xt);A(this,Le,new Lr);A(this,Yt,"gzip");A(this,er,!1);A(this,tr);A(this,Ct);this.remoteModule=t,this.dbConnectionCtor=r,I(this,Ct,so.createWebSocketFn)}withUri(t){return I(this,Mt,new URL(t)),this}withModuleName(t){return I(this,At,t),this}withToken(t){return I(this,Xt,t),this}withWSFn(t){return I(this,Ct,t),this}withCompression(t){return I(this,Yt,t),this}withLightMode(t){return I(this,er,t),this}withConfirmedReads(t){return I(this,tr,t),this}onConnect(t){return o(this,Le).on("connect",t),this}onConnectError(t){return o(this,Le).on("connectError",t),this}onDisconnect(t){return o(this,Le).on("disconnect",t),this}build(){var t;if(!o(this,Mt))throw new Error("URI is required to connect to SpacetimeDB");if(!o(this,At))throw new Error("Database name or address is required to connect to SpacetimeDB");return io((t=this.remoteModule.versionInfo)==null?void 0:t.cliVersion),this.dbConnectionCtor({uri:o(this,Mt),nameOrAddress:o(this,At),identity:o(this,Pr),token:o(this,Xt),emitter:o(this,Le),compression:o(this,Yt),lightMode:o(this,er),confirmedReads:o(this,tr),createWSFn:o(this,Ct),remoteModule:this.remoteModule})}},Mt=new WeakMap,At=new WeakMap,Pr=new WeakMap,Xt=new WeakMap,Le=new WeakMap,Yt=new WeakMap,er=new WeakMap,tr=new WeakMap,Ct=new WeakMap,ci),rr,nr,li,Wi=(li=class{constructor(e){A(this,rr);A(this,nr);this.db=e}onApplied(e){return I(this,rr,e),this}onError(e){return I(this,nr,e),this}subscribe(e){const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Subscriptions must have at least one query");return new co(this.db,t,o(this,rr),o(this,nr))}subscribeToAllTables(){this.subscribe("SELECT * FROM *")}},rr=new WeakMap,nr=new WeakMap,li),oo=class{constructor(){v(this,"subscriptions",new Map)}},Et,je,we,_e,Ie,di,co=(di=class{constructor(e,t,r,n){A(this,Et);A(this,je,!1);A(this,we,!1);A(this,_e,!1);A(this,Ie,new Lr);this.db=e,o(this,Ie).on("applied",a=>{I(this,_e,!0),r&&r(a)}),o(this,Ie).on("error",(a,s)=>{I(this,_e,!1),I(this,we,!0),n&&n(a,s)}),I(this,Et,this.db.registerSubscription(this,o(this,Ie),t))}unsubscribe(){if(o(this,je))throw new Error("Unsubscribe has already been called");I(this,je,!0),this.db.unregisterSubscription(o(this,Et)),o(this,Ie).on("end",e=>{I(this,we,!0),I(this,_e,!1)})}unsubscribeThen(e){if(o(this,we))throw new Error("Subscription has already ended");if(o(this,je))throw new Error("Unsubscribe has already been called");I(this,je,!0),this.db.unregisterSubscription(o(this,Et)),o(this,Ie).on("end",t=>{I(this,we,!0),I(this,_e,!1),e(t)})}isEnded(){return o(this,we)}isActive(){return o(this,_e)}},Et=new WeakMap,je=new WeakMap,we=new WeakMap,_e=new WeakMap,Ie=new WeakMap,di);function lo(e){switch(e){case"FullUpdate":return 0;case"NoSuccessNotify":return 1}}var ir,Vr,W,kt,Nr,ar,ce,He,sr,Rt,Or,Kr,C,$i,Qi,Gi,Ji,ve,Zi,Ht,Xi,Ne,Yi,ea,pi,po=(pi=class{constructor({uri:e,nameOrAddress:t,identity:r,token:n,emitter:a,remoteModule:s,createWSFn:c,compression:l,lightMode:p,confirmedReads:f}){A(this,C);v(this,"isActive",!1);v(this,"identity");v(this,"token");v(this,"db");v(this,"reducers");v(this,"setReducerFlags");v(this,"procedures");v(this,"connectionId",Cr.random());A(this,ir,0);A(this,Vr,0);A(this,W);A(this,kt,new Lr);A(this,Nr);A(this,ar,Promise.resolve());A(this,ce,new oo);A(this,He);A(this,sr,new Map);A(this,Rt,new Map);v(this,"clientCache");v(this,"ws");v(this,"wsPromise");A(this,Or,()=>{const e=o(this,ir);return I(this,ir,o(this,ir)+1),e});A(this,Kr,()=>Mn(this,Vr)._++);v(this,"subscriptionBuilder",()=>new Wi(this));xe("info","Connecting to SpacetimeDB WS...");const h=new URL(e.toString());/^wss?:/.test(e.protocol)||(h.protocol=h.protocol==="https:"?"wss:":"ws:"),this.identity=r,this.token=n,I(this,He,s),I(this,W,a);const U=this.connectionId.toHexString();h.searchParams.set("connection_id",U),this.clientCache=new ro,this.db=T(this,C,$i).call(this,s),this.reducers=T(this,C,Qi).call(this,s),this.setReducerFlags=T(this,C,Gi).call(this,s),this.procedures=T(this,C,Ji).call(this,s),this.wsPromise=c({url:h,nameOrAddress:t,wsProtocol:"v1.bsatn.spacetimedb",authToken:n,compression:l,lightMode:p,confirmedReads:f}).then(_=>(this.ws=_,this.ws.onclose=()=>{o(this,W).emit("disconnect",this),this.isActive=!1},this.ws.onerror=y=>{o(this,W).emit("connectError",this,y),this.isActive=!1},this.ws.onopen=T(this,C,Xi).bind(this),this.ws.onmessage=T(this,C,ea).bind(this),_)).catch(_=>{xe("error","Error connecting to SpacetimeDB WS"),o(this,W).emit("connectError",this,_)})}registerSubscription(e,t,r){const n=o(this,Or).call(this);return o(this,ce).subscriptions.set(n,{handle:e,emitter:t}),T(this,C,Ht).call(this,Kt.SubscribeMulti({queryStrings:r,queryId:{id:n},requestId:0})),n}unregisterSubscription(e){T(this,C,Ht).call(this,Kt.UnsubscribeMulti({queryId:{id:e},requestId:0}))}callReducer(e,t,r){const n=Kt.CallReducer({reducer:e,args:t,requestId:0,flags:lo(r)});T(this,C,Ht).call(this,n)}callReducerWithParams(e,t,r,n){const a=new We(1024);Ke.serializeValue(a,t,r);const s=a.getBuffer();this.callReducer(e,s,n)}callProcedure(e,t){const{promise:r,resolve:n,reject:a}=Promise.withResolvers(),s=o(this,Kr).call(this),c=Kt.CallProcedure({procedure:e,args:t,requestId:s,flags:0});return T(this,C,Ht).call(this,c),o(this,Rt).set(s,l=>{l.tag==="Ok"?n(l.value):a(l.value)}),r}callProcedureWithParams(e,t,r,n){const a=new We(1024);Ke.serializeValue(a,t,r);const s=a.getBuffer();return this.callProcedure(e,s).then(c=>x.deserializeValue(new Oe(c),n))}disconnect(){this.wsPromise.then(e=>{e&&e.close()})}on(e,t){o(this,W).on(e,t)}off(e,t){o(this,W).off(e,t)}onConnect(e){o(this,W).on("connect",e)}onDisconnect(e){o(this,W).on("disconnect",e)}onConnectError(e){o(this,W).on("connectError",e)}removeOnConnect(e){o(this,W).off("connect",e)}removeOnDisconnect(e){o(this,W).off("disconnect",e)}removeOnConnectError(e){o(this,W).off("connectError",e)}onReducer(e,t){o(this,kt).on(e,t)}offReducer(e,t){o(this,kt).off(e,t)}},ir=new WeakMap,Vr=new WeakMap,W=new WeakMap,kt=new WeakMap,Nr=new WeakMap,ar=new WeakMap,ce=new WeakMap,He=new WeakMap,sr=new WeakMap,Rt=new WeakMap,Or=new WeakMap,Kr=new WeakMap,C=new WeakSet,$i=function(e){const t=Object.create(null);for(const r of e.tables){const n=r.accessorName;Object.defineProperty(t,n,{enumerable:!0,configurable:!1,get:()=>this.clientCache.getOrCreateTable(r)})}return t},Qi=function(e){const t={};for(const r of e.reducers){const n=$t(r.name);t[n]=c=>{const l=o(this,sr).get(r.name)??"FullUpdate";this.callReducerWithParams(r.name,r.paramsType,c,l)};const a=`on${Zt(r.name)}`;t[a]=c=>{this.onReducer(r.name,c)};const s=`removeOn${Zt(r.name)}`;t[s]=c=>{this.offReducer(r.name,c)}}return t},Gi=function(e){const t=Object.create(null);for(const r of e.reducers){const n=$t(r.name);Object.defineProperty(t,n,{enumerable:!0,configurable:!1,value:a=>{o(this,sr).set(r.name,a)}})}return t},Ji=function(e){const t={};for(const r of e.procedures){const n=$t(r.name),a=new Dt(r.params).algebraicType.value,s=r.returnType.algebraicType;t[n]=c=>this.callProcedureWithParams(r.name,a,c,s)}return t},ve=function(e){return{db:this.db,reducers:this.reducers,setReducerFlags:this.setReducerFlags,isActive:this.isActive,subscriptionBuilder:this.subscriptionBuilder.bind(this),disconnect:this.disconnect.bind(this),event:e}},Zi=async function(e){const t=(a,s,c)=>{const l=c.rowsData,p=new Oe(l),f=[],h=o(this,He).tables.find(w=>w.name===s),U=h.rowType,y=Object.entries(h.columns).find(w=>w[1].columnMetadata.isPrimaryKey);let b=0;for(;p.remaining>0;){const w=Ke.deserializeValue(p,U);let m;if(y!==void 0){const g=y[0],S=y[1].typeBuilder.algebraicType;m=x.intoMapKey(S,w[g])}else{const g=l.subarray(b,p.offset);m=Ui.fromByteArray(g)}b=p.offset,f.push({type:a,rowId:m,row:w})}return f},r=async a=>{const s=a.tableName;let c=[];for(const l of a.updates){let p;if(l.tag==="Gzip"){const f=await Ki(l.value,"gzip");p=x.deserializeValue(new Oe(f),Di.algebraicType)}else{if(l.tag==="Brotli")throw new Error("Brotli compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");p=l.value}c=c.concat(t("insert",s,p.inserts)),c=c.concat(t("delete",s,p.deletes))}return{tableName:s,operations:c}},n=async a=>{const s=[];for(const c of a.tables)s.push(await r(c));return s};switch(e.tag){case"InitialSubscription":{const a=e.value.databaseUpdate;return{tag:"InitialSubscription",tableUpdates:await n(a)}}case"TransactionUpdateLight":{const a=e.value.update;return{tag:"TransactionUpdateLight",tableUpdates:await n(a)}}case"TransactionUpdate":{const a=e.value,s=a.callerIdentity,c=Cr.nullIfZero(a.callerConnectionId),l=a.reducerCall.reducerName,p=a.reducerCall.args,f=a.energyQuantaUsed;let h=[],U="";switch(a.status.tag){case"Committed":h=await n(a.status.value);break;case"Failed":h=[],U=a.status.value;break;case"OutOfEnergy":h=[];break}if(l==="<none>"){console.error(`Received an error from the database: ${U}`);return}let _;return l!==""&&(_={reducerName:l,args:p}),{tag:"TransactionUpdate",tableUpdates:h,identity:s,connectionId:c,reducerInfo:_,status:a.status,energyConsumed:f.quanta,message:U,timestamp:a.timestamp}}case"IdentityToken":return{tag:"IdentityToken",identity:e.value.identity,token:e.value.token,connectionId:e.value.connectionId};case"OneOffQueryResponse":throw new Error(`TypeScript SDK never sends one-off queries, but got OneOffQueryResponse ${e}`);case"SubscribeMultiApplied":{const a=await n(e.value.update);return{tag:"SubscribeApplied",queryId:e.value.queryId.id,tableUpdates:a}}case"UnsubscribeMultiApplied":{const a=await n(e.value.update);return{tag:"UnsubscribeApplied",queryId:e.value.queryId.id,tableUpdates:a}}case"SubscriptionError":return{tag:"SubscriptionError",queryId:e.value.queryId,error:e.value.error};case"ProcedureResult":{const{status:a,requestId:s}=e.value;return{tag:"ProcedureResult",requestId:s,result:a.tag==="Returned"?{tag:"Ok",value:a.value}:a.tag==="OutOfEnergy"?{tag:"Err",value:"Procedure execution aborted due to insufficient energy"}:{tag:"Err",value:a.value}}}}},Ht=function(e){this.wsPromise.then(t=>{if(t){const r=new We(1024);x.serializeValue(r,Kt.algebraicType,e);const n=r.getBuffer();t.send(n)}})},Xi=function(){this.isActive=!0},Ne=function(e,t){const r=[];for(const n of e){const a=n.tableName,s=o(this,He).tables.find(p=>p.name===a),l=this.clientCache.getOrCreateTable(s).applyOperations(n.operations,t);for(const p of l)r.push(p)}return r},Yi=async function(e){var n,a;const t=x.deserializeValue(new Oe(e),Ju.algebraicType),r=await T(this,C,Zi).call(this,t);if(r)switch(r.tag){case"InitialSubscription":{const s={tag:"SubscribeApplied"},c=T(this,C,ve).call(this,s),{event:l,...p}=c,f=T(this,C,Ne).call(this,r.tableUpdates,c);o(this,W)&&((n=o(this,Nr))==null||n.call(this,p));for(const h of f)h.cb();break}case"TransactionUpdateLight":{const s={tag:"UnknownTransaction"},c=T(this,C,ve).call(this,s),l=T(this,C,Ne).call(this,r.tableUpdates,c);for(const p of l)p.cb();break}case"TransactionUpdate":{let s=r.reducerInfo;const c=s===void 0?void 0:o(this,He).reducers.find(b=>b.name===s.reducerName);let l,p=c===void 0;if(c)try{const b=new Oe(s.args);l=Ke.deserializeValue(b,c.paramsType)}catch{console.debug("Failed to deserialize reducer arguments"),p=!0}if(p){const b={tag:"UnknownTransaction"},w=T(this,C,ve).call(this,b),m=T(this,C,Ne).call(this,r.tableUpdates,w);for(const g of m)g.cb();return}s=s,l=l;const f={callerIdentity:r.identity,status:r.status,callerConnectionId:r.connectionId,timestamp:r.timestamp,energyConsumed:r.energyConsumed,reducer:{name:s.reducerName,args:l}},h={tag:"Reducer",value:f},U=T(this,C,ve).call(this,h),_={...U,event:f},y=T(this,C,Ne).call(this,r.tableUpdates,U);o(this,kt).emit(s.reducerName,_,l);for(const b of y)b.cb();break}case"IdentityToken":{this.identity=r.identity,!this.token&&r.token&&(this.token=r.token),this.connectionId=r.connectionId,o(this,W).emit("connect",this,this.identity,this.token);break}case"SubscribeApplied":{const s=o(this,ce).subscriptions.get(r.queryId);if(s===void 0){xe("error",`Received SubscribeApplied for unknown queryId ${r.queryId}.`);break}const c={tag:"SubscribeApplied"},l=T(this,C,ve).call(this,c),{event:p,...f}=l,h=T(this,C,Ne).call(this,r.tableUpdates,l);s==null||s.emitter.emit("applied",f);for(const U of h)U.cb();break}case"UnsubscribeApplied":{const s=o(this,ce).subscriptions.get(r.queryId);if(s===void 0){xe("error",`Received UnsubscribeApplied for unknown queryId ${r.queryId}.`);break}const c={tag:"UnsubscribeApplied"},l=T(this,C,ve).call(this,c),{event:p,...f}=l,h=T(this,C,Ne).call(this,r.tableUpdates,l);s==null||s.emitter.emit("end",f),o(this,ce).subscriptions.delete(r.queryId);for(const U of h)U.cb();break}case"SubscriptionError":{const s=Error(r.error),c={tag:"Error",value:s},p={...T(this,C,ve).call(this,c),event:s};r.queryId!==void 0?((a=o(this,ce).subscriptions.get(r.queryId))==null||a.emitter.emit("error",p,s),o(this,ce).subscriptions.delete(r.queryId)):(console.error("Received an error message without a queryId: ",s),o(this,ce).subscriptions.forEach(({emitter:f})=>{f.emit("error",p,s)}));break}case"ProcedureResult":{const{requestId:s,result:c}=r,l=o(this,Rt).get(s);o(this,Rt).delete(s),l==null||l(c);break}}},ea=function(e){I(this,ar,o(this,ar).then(()=>T(this,C,Yi).call(this,e.data)))},pi),mo=i.enum("Lifecycle",{Init:i.unit(),OnConnect:i.unit(),OnDisconnect:i.unit()}),Bn=mo;function jr(e,t,r,n){if(Jn.has(e))throw new TypeError(`There is already a reducer with the name '${e}'`);Jn.add(e),t instanceof le||(t=new le(t)),t.typeName===void 0&&(t.typeName=Zt(e));const a=ee(t),s=ta(te.typespace,a).value;te.reducers.push({name:e,params:s,lifecycle:n}),r.name||Object.defineProperty(r,"name",{value:e,writable:!1})}var Jn=new Set;function Zn(e,t,r){jr(e,t,r)}function ho(e,t,r){jr(e,t,r,Bn.Init)}function fo(e,t,r){jr(e,t,r,Bn.OnConnect)}function yo(e,t,r){jr(e,t,r,Bn.OnDisconnect)}var go=class{constructor(e){v(this,"reducersType");this.reducersType=bo(e)}};function bo(e){return{reducers:e.map(n=>{const a=n.params.row;return{name:n.reducerName,accessorName:n.accessorName,params:a,paramsType:n.paramsSpacetimeType}})}}function vo(...e){const t=e.length===1&&Array.isArray(e[0])?e[0]:e;return new go(t)}function V(e,t){const r={elements:Object.entries(t).map(([n,a])=>({name:n,algebraicType:"typeBuilder"in a?a.typeBuilder.algebraicType:a.algebraicType}))};return{reducerName:e,accessorName:$t(e),params:new le(t),paramsSpacetimeType:r,reducerDef:{name:e,params:r,lifecycle:void 0}}}function Xn(e,t,r,n,a){const s=new le(r,Zt(e.name));let c=ee(n).algebraicType;const{value:l}=ta(te.typespace,ee(s));if(te.miscExports.push({tag:"View",value:{name:e.name,index:(t?ei:Yn).length,isPublic:e.public,isAnonymous:t,params:l,returnType:c}}),c.tag=="Sum"){const p=a;a=((f,h)=>{const U=p(f,h);return U==null?[]:[U]}),c=x.Array(c.value.variants[0].algebraicType)}(t?ei:Yn).push({fn:a,params:l,returnType:c,returnTypeBaseSize:Qt(te.typespace,c)})}var Yn=[],ei=[];function ti(e,t,r,n){const a={elements:Object.entries(t).map(([c,l])=>({name:c,algebraicType:ee("typeBuilder"in l?l.typeBuilder:l).algebraicType}))},s=ee(r).algebraicType;te.miscExports.push({tag:"Procedure",value:{name:e,params:a,returnType:s}}),wo.push({fn:n,paramsType:a,returnType:s,returnTypeBaseSize:Qt(te.typespace,s)})}var wo=[];function _o(...e){return{procedures:e.length===1&&Array.isArray(e[0])?e[0]:e}}function Io(e){return{tables:e.map(xo)}}function xo(e){const t=r=>e.rowType.algebraicType.value.elements[r].name;return{name:e.tableName,accessorName:$t(e.tableName),columns:e.rowType.row,rowType:e.rowSpacetimeType,constraints:e.tableDef.constraints.map(r=>({name:r.name,constraint:"unique",columns:r.data.value.columns.map(t)})),indexes:e.tableDef.indexes.map(r=>{const n=r.algorithm.tag==="Direct"?[r.algorithm.value]:r.algorithm.value;return{name:r.accessorName,unique:e.tableDef.constraints.some(a=>a.data.value.columns.every(s=>n.includes(s))),algorithm:r.algorithm.tag.toLowerCase(),columns:n.map(t)}})}}var te={typespace:{types:[]},tables:[],reducers:[],types:[],miscExports:[],rowLevelSecurity:[]},ri=new Map;function ta(e,t){let r=t.algebraicType;for(;r.tag==="Ref";)r=e.types[r.value];return r}function ee(e){return e instanceof Dt&&!Bo(e)||e instanceof Un||e instanceof le?Uo(e):e instanceof Er?new Er(ee(e.value)):e instanceof un?new un(ee(e.ok),ee(e.err)):e instanceof sn?new sn(ee(e.element)):e}function Uo(e){const t=e.algebraicType,r=e.typeName;if(r===void 0)throw new Error(`Missing type name for ${e.constructor.name??"TypeBuilder"} ${JSON.stringify(e)}`);let n=ri.get(t);if(n!=null)return n;const a=e instanceof le||e instanceof Dt?{tag:"Product",value:{elements:[]}}:{tag:"Sum",value:{variants:[]}};if(n=new yu(te.typespace.types.length),te.typespace.types.push(a),ri.set(t,n),e instanceof le)for(const[s,c]of Object.entries(e.row))a.value.elements.push({name:s,algebraicType:ee(c.typeBuilder).algebraicType});else if(e instanceof Dt)for(const[s,c]of Object.entries(e.elements))a.value.elements.push({name:s,algebraicType:ee(c).algebraicType});else if(e instanceof Un)for(const[s,c]of Object.entries(e.variants))a.value.variants.push({name:s,algebraicType:ee(c).algebraicType});return te.types.push({name:So(r),ty:n.ref,customOrdering:!0}),n}function Bo(e){return e.typeName==null&&e.algebraicType.value.elements.length===0}function So(e){const t=e.split(".");return{name:t.pop(),scope:t}}var To=class{constructor(e,t,r){v(this,"tablesDef");v(this,"typespace");v(this,"schemaType");v(this,"clientVisibilityFilter",{sql(e){te.rowLevelSecurity.push({sql:e})}});this.tablesDef={tables:e},this.typespace=t,this.schemaType=Io(r)}reducer(e,t,r){return typeof t=="function"?(Zn(e,{},t),t):(Zn(e,t,r),r)}init(e,t){const[r,n]=typeof e=="string"?[e,t]:["init",e];ho(r,{},n)}clientConnected(e,t){const[r,n]=typeof e=="string"?[e,t]:["on_connect",e];fo(r,{},n)}clientDisconnected(e,t){const[r,n]=typeof e=="string"?[e,t]:["on_disconnect",e];yo(r,{},n)}view(e,t,r){Xn(e,!1,{},t,r)}anonymousView(e,t,r){Xn(e,!0,{},t,r)}procedure(e,t,r,n){return typeof r=="function"?(ti(e,{},t,r),r):(ti(e,t,r,n),n)}};function Mo(...e){const t=e.length===1&&Array.isArray(e[0])?e[0]:e,r=t.map(n=>n.tableDef);return te.tables.push(...r),t.map(n=>({name:n.tableName,accessorName:n.tableName,columns:n.rowType.row,rowType:n.rowSpacetimeType,indexes:n.idxs,constraints:n.constraints})),new To(r,te.typespace,t)}function ra(e){return Object.fromEntries(e.map(t=>[t.accessorName,t]))}var Ao=i.enum("RawIndexAlgorithm",{BTree:i.array(i.u16()),Hash:i.array(i.u16()),Direct:i.u16()}),ni=Ao;function Se(e,t){const{name:r,public:n=!1,indexes:a=[],scheduled:s}=e,c=new Map,l=[];t instanceof le||(t=new le(t)),t.typeName===void 0&&(t.typeName=Zt(r));const p=ee(t);t.algebraicType.value.elements.forEach((m,g)=>{c.set(m.name,g),l.push(m.name)});const f=[],h=[],U=[],_=[];let y;for(const[m,g]of Object.entries(t.row)){const S=g.columnMetadata;S.isPrimaryKey&&f.push(c.get(m));const D=S.isUnique||S.isPrimaryKey;if(S.indexType||D){const N=S.indexType??"btree",P=c.get(m);let O;switch(N){case"btree":O=ni.BTree([P]);break;case"direct":O=ni.Direct(P);break}h.push({name:void 0,accessorName:m,algorithm:O})}if(D&&U.push({name:void 0,data:{tag:"Unique",value:{columns:[c.get(m)]}}}),S.isAutoIncrement&&_.push({name:void 0,start:void 0,minValue:void 0,maxValue:void 0,column:c.get(m),increment:1n}),s){const N=g.typeBuilder.algebraicType;ki.isScheduleAt(N)&&(y=c.get(m))}}for(const m of a??[]){let g;switch(m.algorithm){case"btree":g={tag:"BTree",value:m.columns.map(S=>c.get(S))};break;case"direct":g={tag:"Direct",value:c.get(m.column)};break}h.push({name:void 0,accessorName:m.name,algorithm:g})}for(const m of e.constraints??[])if(m.constraint==="unique"){const g={tag:"Unique",value:{columns:m.columns.map(S=>c.get(S))}};U.push({name:m.name,data:g});continue}for(const m of h){const S=(m.algorithm.tag==="Direct"?[m.algorithm.value]:m.algorithm.value).map(D=>l[D]).join("_");m.name=`${r}_${S}_idx_${m.algorithm.tag.toLowerCase()}`}const b={name:r,productTypeRef:p.ref,primaryKey:f,indexes:h,constraints:U,sequences:_,schedule:s&&y!==void 0?{name:void 0,reducerName:s,scheduledAtColumn:y}:void 0,tableType:{tag:"User"},tableAccess:{tag:n?"Public":"Private"}},w=t.algebraicType.value;return{rowType:t,tableName:r,rowSpacetimeType:w,tableDef:b,idxs:{},constraints:U}}const Co={entryId:i.u32(),startMs:i.u32(),endMs:i.u32(),pyannoteLabel:i.string(),matchedSpeaker:i.option(i.string()),confidence:i.option(i.f32()),transcriptSlice:i.option(i.string())},Eo={sessionId:i.u32(),entryId:i.string(),durationMs:i.u32(),transcript:i.option(i.string()),confidence:i.option(i.f32()),audioClipPath:i.option(i.string()),recordingStartMs:i.u32(),recordingEndMs:i.u32()},ko={name:i.string(),embedding:i.option(i.byteArray())},Ro={entryId:i.u32()},qo={name:i.string()},Do={deviceIdentity:i.string()},Fo={deviceId:i.u32()},Po={entryId:i.u32(),reviewed:i.bool()},Vo={deviceIdentity:i.string(),name:i.string(),platform:i.string()},No={deviceId:i.u32(),inputNames:i.array(i.string())},Oo={deviceId:i.u32(),inputIndex:i.i32()},Ko={deviceId:i.u32(),isMuted:i.bool()},zo={deviceId:i.u32(),isPaused:i.bool()},Lo={deviceId:i.u32(),threshold:i.f32()},jo={deviceId:i.u32(),date:i.string(),mode:i.string(),audioPath:i.string()},Ho={deviceIdentity:i.string(),status:i.string()},Wo={segmentId:i.u32(),matchedSpeaker:i.string(),confidence:i.f32()},$o={entryId:i.u32(),transcript:i.option(i.string()),speakerName:i.option(i.string()),sentiment:i.option(i.string()),notes:i.option(i.string())},Qo={entryId:i.u32(),notes:i.string()},Go={entryId:i.u32(),sentiment:i.string()},Jo={entryId:i.u32(),speakerName:i.string()},Zo={entryId:i.u32(),transcript:i.string()},Xo={sessionId:i.u32(),durationMs:i.u32()},Yo={sessionId:i.u32(),status:i.string()},ec={name:i.string(),threshold:i.f32()},tc={deviceId:i.u32(),minConfidence:i.f32(),language:i.string()},rc={deviceId:i.u32(),silenceThreshold:i.f32(),minSpeechDurationMs:i.u32(),maxSpeechDurationMs:i.u32(),silenceDurationMs:i.u32()},nc=i.row({id:i.u32().primaryKey().name("Id"),deviceId:i.u32().name("DeviceId"),inputIndex:i.i32().name("InputIndex"),name:i.string().name("Name"),isDefault:i.bool().name("IsDefault"),updatedAt:i.timestamp().name("UpdatedAt")}),ic=i.row({id:i.u32().primaryKey().name("Id"),deviceId:i.u32().name("DeviceId"),date:i.string().name("Date"),mode:i.string().name("Mode"),status:i.string().name("Status"),audioPath:i.string().name("AudioPath"),startedAt:i.timestamp().name("StartedAt"),endedAt:i.option(i.timestamp()).name("EndedAt"),durationMs:i.u32().name("DurationMs")}),ac=i.row({deviceId:i.u32().primaryKey().name("DeviceId"),selectedAudioInputIndex:i.i32().name("SelectedAudioInputIndex"),silenceThreshold:i.f32().name("SilenceThreshold"),minSpeechDurationMs:i.u32().name("MinSpeechDurationMs"),maxSpeechDurationMs:i.u32().name("MaxSpeechDurationMs"),silenceDurationMs:i.u32().name("SilenceDurationMs"),minConfidence:i.f32().name("MinConfidence"),language:i.string().name("Language"),isPaused:i.bool().name("IsPaused"),isMuted:i.bool().name("IsMuted"),updatedAt:i.timestamp().name("UpdatedAt")}),sc=i.row({id:i.u32().primaryKey().name("Id"),deviceIdentity:i.string().name("DeviceIdentity"),name:i.string().name("Name"),platform:i.string().name("Platform"),status:i.string().name("Status"),lastHeartbeat:i.timestamp().name("LastHeartbeat"),createdAt:i.timestamp().name("CreatedAt")}),uc=i.row({id:i.u32().primaryKey().name("Id"),entryId:i.u32().name("EntryId"),startMs:i.u32().name("StartMs"),endMs:i.u32().name("EndMs"),pyannoteLabel:i.string().name("PyannoteLabel"),matchedSpeaker:i.option(i.string()).name("MatchedSpeaker"),confidence:i.option(i.f32()).name("Confidence"),transcriptSlice:i.option(i.string()).name("TranscriptSlice")}),oc=i.row({id:i.u32().primaryKey().name("Id"),name:i.string().name("Name"),similarityThreshold:i.f32().name("SimilarityThreshold"),embedding:i.option(i.byteArray()).name("Embedding"),sampleCount:i.u32().name("SampleCount"),createdAt:i.timestamp().name("CreatedAt"),updatedAt:i.timestamp().name("UpdatedAt")}),cc=i.row({id:i.u32().primaryKey().name("Id"),sessionId:i.u32().name("SessionId"),entryId:i.string().name("EntryId"),timestamp:i.timestamp().name("Timestamp"),durationMs:i.u32().name("DurationMs"),transcript:i.option(i.string()).name("Transcript"),confidence:i.option(i.f32()).name("Confidence"),speaker:i.option(i.string()).name("Speaker"),sentiment:i.option(i.string()).name("Sentiment"),intent:i.option(i.string()).name("Intent"),audioClipPath:i.option(i.string()).name("AudioClipPath"),recordingStartMs:i.u32().name("RecordingStartMs"),recordingEndMs:i.u32().name("RecordingEndMs"),reviewed:i.bool().name("Reviewed"),notes:i.option(i.string()).name("Notes"),createdAt:i.timestamp().name("CreatedAt"),updatedAt:i.timestamp().name("UpdatedAt")});i.object("AudioInput",{id:i.u32(),deviceId:i.u32(),inputIndex:i.i32(),name:i.string(),isDefault:i.bool(),updatedAt:i.timestamp()});i.object("AudioSession",{id:i.u32(),deviceId:i.u32(),date:i.string(),mode:i.string(),status:i.string(),audioPath:i.string(),startedAt:i.timestamp(),endedAt:i.option(i.timestamp()),durationMs:i.u32()});i.object("CaptureConfig",{deviceId:i.u32(),selectedAudioInputIndex:i.i32(),silenceThreshold:i.f32(),minSpeechDurationMs:i.u32(),maxSpeechDurationMs:i.u32(),silenceDurationMs:i.u32(),minConfidence:i.f32(),language:i.string(),isPaused:i.bool(),isMuted:i.bool(),updatedAt:i.timestamp()});i.object("CaptureDevice",{id:i.u32(),deviceIdentity:i.string(),name:i.string(),platform:i.string(),status:i.string(),lastHeartbeat:i.timestamp(),createdAt:i.timestamp()});i.object("DiarizationSegment",{id:i.u32(),entryId:i.u32(),startMs:i.u32(),endMs:i.u32(),pyannoteLabel:i.string(),matchedSpeaker:i.option(i.string()),confidence:i.option(i.f32()),transcriptSlice:i.option(i.string())});i.object("Speaker",{id:i.u32(),name:i.string(),similarityThreshold:i.f32(),embedding:i.option(i.byteArray()),sampleCount:i.u32(),createdAt:i.timestamp(),updatedAt:i.timestamp()});i.object("TranscriptEntry",{id:i.u32(),sessionId:i.u32(),entryId:i.string(),timestamp:i.timestamp(),durationMs:i.u32(),transcript:i.option(i.string()),confidence:i.option(i.f32()),speaker:i.option(i.string()),sentiment:i.option(i.string()),intent:i.option(i.string()),audioClipPath:i.option(i.string()),recordingStartMs:i.u32(),recordingEndMs:i.u32(),reviewed:i.bool(),notes:i.option(i.string()),createdAt:i.timestamp(),updatedAt:i.timestamp()});const na=Mo(Se({name:"audio_input",indexes:[{name:"Id",algorithm:"btree",columns:["id"]}],constraints:[{name:"audio_input_Id_key",constraint:"unique",columns:["id"]}]},nc),Se({name:"audio_session",indexes:[{name:"Id",algorithm:"btree",columns:["id"]}],constraints:[{name:"audio_session_Id_key",constraint:"unique",columns:["id"]}]},ic),Se({name:"capture_config",indexes:[{name:"DeviceId",algorithm:"btree",columns:["deviceId"]}],constraints:[{name:"capture_config_DeviceId_key",constraint:"unique",columns:["deviceId"]}]},ac),Se({name:"capture_device",indexes:[{name:"DeviceIdentity",algorithm:"btree",columns:["deviceIdentity"]},{name:"Id",algorithm:"btree",columns:["id"]}],constraints:[{name:"capture_device_DeviceIdentity_key",constraint:"unique",columns:["deviceIdentity"]},{name:"capture_device_Id_key",constraint:"unique",columns:["id"]}]},sc),Se({name:"diarization_segment",indexes:[{name:"Id",algorithm:"btree",columns:["id"]}],constraints:[{name:"diarization_segment_Id_key",constraint:"unique",columns:["id"]}]},uc),Se({name:"speaker",indexes:[{name:"Id",algorithm:"btree",columns:["id"]},{name:"Name",algorithm:"btree",columns:["name"]}],constraints:[{name:"speaker_Id_key",constraint:"unique",columns:["id"]},{name:"speaker_Name_key",constraint:"unique",columns:["name"]}]},oc),Se({name:"transcript_entry",indexes:[{name:"Id",algorithm:"btree",columns:["id"]}],constraints:[{name:"transcript_entry_Id_key",constraint:"unique",columns:["id"]}]},cc)),ia=vo(V("CreateDiarizationSegment",Co),V("CreateEntry",Eo),V("CreateOrUpdateSpeaker",ko),V("DeleteEntry",Ro),V("DeleteSpeaker",qo),V("DeviceHeartbeat",Do),V("InitCaptureConfig",Fo),V("MarkEntryReviewed",Po),V("RegisterDevice",Vo),V("ReportAudioInputs",No),V("SetAudioInput",Oo),V("SetCaptureMuted",Ko),V("SetCapturePaused",zo),V("SetSilenceThreshold",Lo),V("StartSession",jo),V("UpdateDeviceStatus",Ho),V("UpdateDiarizationSegmentSpeaker",Wo),V("UpdateEntry",$o),V("UpdateEntryNotes",Qo),V("UpdateEntrySentiment",Go),V("UpdateEntrySpeaker",Jo),V("UpdateEntryTranscript",Zo),V("UpdateSessionDuration",Xo),V("UpdateSessionStatus",Yo),V("UpdateSpeakerThreshold",ec),V("UpdateTranscriptionConfig",tc),V("UpdateVadConfig",rc)),lc=_o(),dc={versionInfo:{cliVersion:"1.11.3"},tables:na.schemaType.tables,reducers:ia.reducersType.reducers,...lc};ra(na.schemaType.tables);ra(ia.reducersType.reducers);class pc extends Wi{}class mc extends uo{}const zr=class zr extends po{constructor(){super(...arguments);v(this,"subscriptionBuilder",()=>new pc(this))}};v(zr,"builder",()=>new mc(dc,r=>new zr(r)));let wn=zr;const hc="ws://127.0.0.1:3000",fc="ambient-listener";let j=null;const Yr=re(!1),Ur=re(!1),en=re(null),$e=re([]),kr=re([]),Gt=re([]),Rr=re([]),Sr=re([]),qr=re([]),Tr=re([]),yc=re(new Date().toISOString().split("T")[0]),aa=re(null),Gc=re(!1);function Mr(e){return typeof e.toDate=="function"?e.toDate():new Date(Number(e))}const Jc=Qe([$e,aa],([e,t])=>t===null?null:e.find(r=>r.id===t)??null),Zc=Qe([$e,yc],([e,t])=>e.filter(r=>Mr(r.timestamp).toISOString().split("T")[0]===t).sort((r,n)=>Mr(n.timestamp).getTime()-Mr(r.timestamp).getTime())),Sn=Qe(Rr,e=>e.length>0?e[0]:null),Xc=Qe([qr,Sn],([e,t])=>t?e.find(r=>r.deviceId===t.id)??null:null),Yc=Qe([kr,Sn],([e,t])=>t?e.find(r=>r.deviceId===t.id&&r.status==="recording")??null:null),el=Qe([Gt,Sn],([e,t])=>t?e.filter(r=>r.deviceId===t.id):[]),tl=Qe($e,e=>{const t=new Set;return e.forEach(r=>{const n=Mr(r.timestamp).toISOString().split("T")[0];t.add(n)}),Array.from(t).sort().reverse()});function gc(e){e.db.transcriptEntry.onInsert((t,r)=>{$e.update(n=>n.some(a=>a.id===r.id)?n:[...n,r])}),e.db.transcriptEntry.onUpdate((t,r,n)=>{$e.update(a=>a.map(s=>s.id===r.id?n:s))}),e.db.transcriptEntry.onDelete((t,r)=>{$e.update(n=>n.filter(a=>a.id!==r.id)),aa.update(n=>n===r.id?null:n)}),e.db.audioSession.onInsert((t,r)=>{kr.update(n=>n.some(a=>a.id===r.id)?n:[...n,r])}),e.db.audioSession.onUpdate((t,r,n)=>{kr.update(a=>a.map(s=>s.id===r.id?n:s))}),e.db.audioInput.onInsert((t,r)=>{Gt.update(n=>n.some(a=>a.id===r.id)?n:[...n,r])}),e.db.audioInput.onUpdate((t,r,n)=>{Gt.update(a=>a.map(s=>s.id===r.id?n:s))}),e.db.audioInput.onDelete((t,r)=>{Gt.update(n=>n.filter(a=>a.id!==r.id))}),e.db.captureDevice.onInsert((t,r)=>{Rr.update(n=>n.some(a=>a.id===r.id)?n:[...n,r])}),e.db.captureDevice.onUpdate((t,r,n)=>{Rr.update(a=>a.map(s=>s.id===r.id?n:s))}),e.db.speaker.onInsert((t,r)=>{Sr.update(n=>n.some(a=>a.id===r.id)?n:[...n,r])}),e.db.speaker.onUpdate((t,r,n)=>{Sr.update(a=>a.map(s=>s.id===r.id?n:s))}),e.db.speaker.onDelete((t,r)=>{Sr.update(n=>n.filter(a=>a.id!==r.id))}),e.db.captureConfig.onInsert((t,r)=>{qr.update(n=>n.some(a=>a.deviceId===r.deviceId)?n:[...n,r])}),e.db.captureConfig.onUpdate((t,r,n)=>{qr.update(a=>a.map(s=>s.deviceId===r.deviceId?n:s))}),e.db.diarizationSegment.onInsert((t,r)=>{Tr.update(n=>n.some(a=>a.id===r.id)?n:[...n,r])}),e.db.diarizationSegment.onUpdate((t,r,n)=>{Tr.update(a=>a.map(s=>s.id===r.id?n:s))}),e.db.diarizationSegment.onDelete((t,r)=>{Tr.update(n=>n.filter(a=>a.id!==r.id))})}function rl(){if(j||fs(Ur)){console.log("Already connected or connecting");return}Ur.set(!0),en.set(null);const e=wn.builder().withUri(hc).withModuleName(fc).onConnect((t,r,n)=>{console.log("Connected to SpacetimeDB",r.toHexString()),Yr.set(!0),Ur.set(!1),en.set(null),e.subscriptionBuilder().onApplied(()=>{console.log("Subscription applied"),$e.set(Array.from(e.db.transcriptEntry.iter())),kr.set(Array.from(e.db.audioSession.iter())),Gt.set(Array.from(e.db.audioInput.iter())),Rr.set(Array.from(e.db.captureDevice.iter())),Sr.set(Array.from(e.db.speaker.iter())),qr.set(Array.from(e.db.captureConfig.iter())),Tr.set(Array.from(e.db.diarizationSegment.iter()))}).subscribe(["SELECT * FROM transcript_entry","SELECT * FROM audio_session","SELECT * FROM audio_input","SELECT * FROM capture_device","SELECT * FROM speaker","SELECT * FROM capture_config","SELECT * FROM diarization_segment"])}).onConnectError((t,r)=>{console.error("Connection error",r),Yr.set(!1),Ur.set(!1),en.set(r instanceof Error?r.message:String(r)),j=null}).onDisconnect((t,r)=>{console.log("Disconnected from SpacetimeDB",r),j===e&&(Yr.set(!1),j=null)}).build();j=e,gc(e)}function nl(e,t){if(!j){console.error("updateEntry: no connection");return}j.reducers.updateEntry({entryId:e,transcript:t.transcript??void 0,speakerName:t.speaker??void 0,sentiment:t.sentiment??void 0,notes:t.notes??void 0})}function il(e,t){j&&j.reducers.markEntryReviewed({entryId:e,reviewed:t})}function al(e){j&&j.reducers.deleteEntry({entryId:e})}function sl(e){if(!j){console.error("createSpeaker: no connection");return}j.reducers.createOrUpdateSpeaker({name:e,embedding:void 0})}function ul(e,t){if(!j){console.error("setSilenceThreshold: no connection");return}j.reducers.setSilenceThreshold({deviceId:e,threshold:t})}function ol(e,t){j&&j.reducers.setAudioInput({deviceId:e,inputIndex:t})}function cl(e,t){if(!j){console.error("setCapturePaused: no connection");return}j.reducers.setCapturePaused({deviceId:e,isPaused:t})}function ll(e,t){j&&j.reducers.setCaptureMuted({deviceId:e,isMuted:t})}var bc=$('<line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>',1),vc=$('<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>',1),wc=$('<polygon points="5 3 19 12 5 21 5 3" fill="currentColor"></polygon>'),_c=$('<rect x="6" y="4" width="4" height="16" fill="currentColor"></rect><rect x="14" y="4" width="4" height="16" fill="currentColor"></rect>',1),Ic=$('<polyline points="20 6 9 17 4 12"></polyline>'),xc=$('<polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>',1),Uc=$('<polyline points="15 18 9 12 15 6"></polyline>'),Bc=$('<polyline points="9 18 15 12 9 6"></polyline>'),Sc=$('<path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line>',1),Tc=$('<line x1="1" y1="1" x2="23" y2="23"></line><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"></path><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line>',1),Mc=$('<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>',1),Ac=$('<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line>',1),Cc=$('<circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>',1),Ec=$('<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>',1),kc=$('<circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>',1),Rc=$('<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>',1),qc=$('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><!></svg>');function dl(e,t){let r=ws(t,"size",3,20);var n=qc(),a=gs(n);{var s=l=>{var p=bc();ie(2),E(l,p)},c=l=>{var p=J(),f=G(p);{var h=_=>{var y=vc();ie(),E(_,y)},U=_=>{var y=J(),b=G(y);{var w=g=>{var S=wc();E(g,S)},m=g=>{var S=J(),D=G(S);{var N=O=>{var K=_c();ie(),E(O,K)},P=O=>{var K=J(),ne=G(K);{var Y=se=>{var pe=Ic();E(se,pe)},Z=se=>{var pe=J(),or=G(pe);{var cr=me=>{var Be=xc();ie(),E(me,Be)},lr=me=>{var Be=J(),dr=G(Be);{var ue=Ge=>{var mr=Uc();E(Ge,mr)},pr=Ge=>{var mr=J(),ua=G(mr);{var oa=Je=>{var hr=Bc();E(Je,hr)},ca=Je=>{var hr=J(),la=G(hr);{var da=Ze=>{var fr=Sc();ie(3),E(Ze,fr)},pa=Ze=>{var fr=J(),ma=G(fr);{var ha=Xe=>{var yr=Tc();ie(4),E(Xe,yr)},fa=Xe=>{var yr=J(),ya=G(yr);{var ga=Ye=>{var gr=Mc();ie(),E(Ye,gr)},ba=Ye=>{var gr=J(),va=G(gr);{var wa=et=>{var br=Ac();ie(2),E(et,br)},_a=et=>{var br=J(),Ia=G(br);{var xa=tt=>{var vr=Cc();ie(),E(tt,vr)},Ua=tt=>{var vr=J(),Ba=G(vr);{var Sa=rt=>{var wr=Ec();ie(),E(rt,wr)},Ta=rt=>{var wr=J(),Ma=G(wr);{var Aa=nt=>{var _r=kc();ie(),E(nt,_r)},Ca=nt=>{var _r=J(),Ea=G(_r);{var ka=Hr=>{var Ra=Rc();ie(2),E(Hr,Ra)};Q(Ea,Hr=>{t.name==="alert"&&Hr(ka)},!0)}E(nt,_r)};Q(Ma,nt=>{t.name==="settings"?nt(Aa):nt(Ca,!1)},!0)}E(rt,wr)};Q(Ba,rt=>{t.name==="user"?rt(Sa):rt(Ta,!1)},!0)}E(tt,vr)};Q(Ia,tt=>{t.name==="clock"?tt(xa):tt(Ua,!1)},!0)}E(et,br)};Q(va,et=>{t.name==="volume-off"?et(wa):et(_a,!1)},!0)}E(Ye,gr)};Q(ya,Ye=>{t.name==="volume"?Ye(ga):Ye(ba,!1)},!0)}E(Xe,yr)};Q(ma,Xe=>{t.name==="mic-off"?Xe(ha):Xe(fa,!1)},!0)}E(Ze,fr)};Q(la,Ze=>{t.name==="mic"?Ze(da):Ze(pa,!1)},!0)}E(Je,hr)};Q(ua,Je=>{t.name==="chevron-right"?Je(oa):Je(ca,!1)},!0)}E(Ge,mr)};Q(dr,Ge=>{t.name==="chevron-left"?Ge(ue):Ge(pr,!1)},!0)}E(me,Be)};Q(or,me=>{t.name==="trash"?me(cr):me(lr,!1)},!0)}E(se,pe)};Q(ne,se=>{t.name==="check"?se(Y):se(Z,!1)},!0)}E(O,K)};Q(D,O=>{t.name==="pause"?O(N):O(P,!1)},!0)}E(g,S)};Q(b,g=>{t.name==="play"?g(w):g(m,!1)},!0)}E(_,y)};Q(f,_=>{t.name==="close"?_(h):_(U,!1)},!0)}E(l,p)};Q(a,l=>{t.name==="menu"?l(s):l(c,!1)})}bs(n),ys(()=>{Ar(n,"width",r()),Ar(n,"height",r())}),E(e,n)}const Dc=e=>e;function sa(e){const t=e-1;return t*t*t+1}function ii(e){const t=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}function pl(e,{delay:t=0,duration:r=400,easing:n=Dc}={}){const a=+getComputedStyle(e).opacity;return{delay:t,duration:r,easing:n,css:s=>`opacity: ${s*a}`}}function ml(e,{delay:t=0,duration:r=400,easing:n=sa,x:a=0,y:s=0,opacity:c=0}={}){const l=getComputedStyle(e),p=+l.opacity,f=l.transform==="none"?"":l.transform,h=p*(1-c),[U,_]=ii(a),[y,b]=ii(s);return{delay:t,duration:r,easing:n,css:(w,m)=>`
			transform: ${f} translate(${(1-w)*U}${_}, ${(1-w)*y}${b});
			opacity: ${p-h*m}`}}function hl(e,{delay:t=0,duration:r=400,easing:n=sa,axis:a="y"}={}){const s=getComputedStyle(e),c=+s.opacity,l=a==="y"?"height":"width",p=parseFloat(s[l]),f=a==="y"?["top","bottom"]:["left","right"],h=f.map(g=>`${g[0].toUpperCase()}${g.slice(1)}`),U=parseFloat(s[`padding${h[0]}`]),_=parseFloat(s[`padding${h[1]}`]),y=parseFloat(s[`margin${h[0]}`]),b=parseFloat(s[`margin${h[1]}`]),w=parseFloat(s[`border${h[0]}Width`]),m=parseFloat(s[`border${h[1]}Width`]);return{delay:t,duration:r,easing:n,css:g=>`overflow: hidden;opacity: ${Math.min(g*20,1)*c};${l}: ${g*p}px;padding-${f[0]}: ${g*U}px;padding-${f[1]}: ${g*_}px;margin-${f[0]}: ${g*y}px;margin-${f[1]}: ${g*b}px;border-${f[0]}-width: ${g*w}px;border-${f[1]}-width: ${g*m}px;min-${l}: 0`}}export{aa as A,tl as B,Mr as C,Zc as D,Jc as E,Hc as F,ml as G,nl as H,dl as I,il as J,al as K,sl as L,Sr as M,Yr as a,Xc as b,Sn as c,Yc as d,Gc as e,pl as f,hl as g,$c as h,Ur as i,el as j,ul as k,cl as l,ll as m,Kc as n,Oc as o,As as p,xi as q,Wc as r,jc as s,zc as t,ol as u,rl as v,en as w,Ar as x,Lc as y,yc as z};
